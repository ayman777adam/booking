<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ â€“ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª + Ø£Ø³Ø¹Ø§Ø± Ø¨ÙˆÙƒÙŠÙ†Ø¬ + Ø§Ù„Ù…ÙˆØ§Ø³Ù…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
* {
  box-sizing: border-box;
}
body {
  margin:0;
  font-family: "Tajawal", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#020617;
  color:#e5e7eb;
}
#switchBar {
  display:flex;
  justify-content:center;
  gap:10px;
  padding:12px;
  background:#020617;
  border-bottom:1px solid #1f2937;
  position:sticky;
  top:0;
  z-index:9999;
}
.switchBtn {
  padding:8px 18px;
  border-radius:999px;
  border:1px solid #1d4ed8;
  background:#1d4ed8;
  color:#e5e7eb;
  cursor:pointer;
  font-size:15px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  transition:background 0.15s ease, box-shadow 0.15s ease, transform 0.08s ease, color 0.15s ease;
}
.switchBtn span.icon {
  font-size:16px;
}
.switchBtn.inactive {
  background:#020617;
  color:#9ca3af;
  border-color:#1f2937;
}
.switchBtn:hover {
  transform:translateY(-1px);
  box-shadow:0 6px 18px rgba(37,99,235,0.45);
}
.frame-wrapper {
  width:100%;
  height:calc(100vh - 60px);
}
iframe {
  width:100%;
  height:100%;
  border:none;
}
/* Ù…ÙˆØ³Ù…/Ø±ÙƒÙˆØ¯ ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ§Ø³Ù… */
#frameSeasons {
  width:100%;
  height:100%;
  padding:20px 12px 80px;
  overflow:auto;
  background:radial-gradient(circle at top left,#0f172a 0,#020617 55%,#000 100%);
}
.seasons-shell {
  max-width:1100px;
  margin:0 auto;
  animation: fadeInUp 0.6s ease-out;
}
.seasons-title {
  font-size:24px;
  margin-bottom:8px;
  color:#38bdf8;
  text-align:center;
}
.seasons-sub {
  font-size:13px;
  color:#9ca3af;
  text-align:center;
  margin-bottom:18px;
}
.seasons-table {
  width:100%;
  border-collapse:collapse;
  background:#020617;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 18px 45px rgba(15,23,42,0.8);
  font-size:14px;
}
.seasons-table thead {
  background:#0f172a;
}
.seasons-table th,
.seasons-table td {
  padding:10px 8px;
  border-bottom:1px solid #111827;
  text-align:center;
  white-space:nowrap;
}
.seasons-table th {
  color:#a5b4fc;
  font-weight:600;
  font-size:13px;
}
.seasons-table tbody tr:nth-child(even) {
  background:#020617;
}
.seasons-table tbody tr:nth-child(odd) {
  background:#020814;
}
.seasons-table tbody tr:hover {
  background:#0b1220;
}
.seasons-table td.event-title {
  text-align:right;
  direction:rtl;
  max-width:260px;
  white-space:normal;
}
.badge {
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:3px 10px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
}
.badge-season {
  background:rgba(22,163,74,0.12);
  color:#4ade80;
  border:1px solid rgba(34,197,94,0.7);
}
.badge-rukood {
  background:rgba(148,163,184,0.15);
  color:#cbd5f5;
  border:1px solid rgba(148,163,184,0.8);
}
.badge-season .dot,
.badge-rukood .dot {
  width:8px;
  height:8px;
  border-radius:999px;
}
.badge-season .dot {
  background:#22c55e;
}
.badge-rukood .dot {
  background:#e5e7eb;
}
.seasons-footer-note {
  margin-top:10px;
  font-size:11px;
  color:#6b7280;
  text-align:center;
}
@keyframes fadeInUp {
  from { opacity:0; transform:translateY(10px); }
  to   { opacity:1; transform:translateY(0); }
}

/* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ø§Ù… */
.sign-off {
  text-align: center;
  padding: 0;
  margin: 20px auto 0; 
  width: 100%;
  max-width: 1200px;
  line-height: 1; 
  font-size: 0.75rem;
}
.sign-off b {
  font-size: 0.85rem; 
  font-weight: bold;
  color:#fff;
}
.sign-off-email {
  font-family: monospace;
  color:#3b82f6;
}
.sign-off.fixed-bottom {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: #1e293b; 
    box-shadow: 0 -2px 10px rgba(0,0,0,0.4);
    padding: 6px 15px; 
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    width: 380px; 
    max-width: 90%; 
}
</style>
<script>
function showFrame(which){
  const fCompare = document.getElementById('frameCompare');
  const fBooking = document.getElementById('frameBooking');
  const fSeasons = document.getElementById('frameSeasons');
  const bCompare = document.getElementById('btnCompare');
  const bBooking = document.getElementById('btnBooking');
  const bSeasons = document.getElementById('btnSeasons');

  fCompare.style.display = (which === 'compare') ? 'block' : 'none';
  fBooking.style.display = (which === 'booking') ? 'block' : 'none';
  fSeasons.style.display = (which === 'seasons') ? 'block' : 'none';

  bCompare.classList.toggle('inactive', which !== 'compare');
  bBooking.classList.toggle('inactive', which !== 'booking');
  bSeasons.classList.toggle('inactive', which !== 'seasons');
}

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø³Ù… / Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª / Ø§Ù„Ø¹ÙˆØ¯Ø©
const seasonEvents = [
  {
    greg: "26/06/2025",
    hijri: "01/01/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨ 1447",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "24/08/2025",
    hijri: "01/03/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026 (1447-1448)",
    type: "Ø±ÙƒÙˆØ¯"
  },
  {
    greg: "23/09/2025",
    hijri: "01/04/1447",
    title: "Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ 2025",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "21/11/2025",
    hijri: "30/05/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ 2025",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "29/11/2025",
    hijri: "08/06/1447",
    title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ 2025",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "11/12/2025",
    hijri: "20/06/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ© 2025",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "14/12/2025",
    hijri: "23/06/1447",
    title: "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© 2025",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "09/01/2026",
    hijri: "20/07/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "17/01/2026",
    hijri: "28/07/1447",
    title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "22/02/2026",
    hijri: "05/09/1447",
    title: "Ø¥Ø¬Ø§Ø²Ø© ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³ 2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "06/03/2026",
    hijri: "17/09/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± 2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "28/03/2026",
    hijri: "09/10/1447",
    title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± 2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "22/05/2026",
    hijri: "15/12/1447",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ 2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "01/06/2026",
    hijri: "25/12/1447",
    title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ 2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "25/06/2026",
    hijri: "10/01/1448",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026",
    type: "Ù…ÙˆØ³Ù…"
  },
  {
    greg: "11/08/2026",
    hijri: "28/02/1448",
    title: "Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ† 2026",
    type: "Ø±ÙƒÙˆØ¯"
  },
  {
    greg: "16/08/2026",
    hijri: "03/03/1448",
    title: "Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† 2026",
    type: "Ø±ÙƒÙˆØ¯"
  },
  {
    greg: "23/08/2026",
    hijri: "10/03/1448",
    title: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2026-2027 (1448-1449)",
    type: "Ø±ÙƒÙˆØ¯"
  }
];

function parseDMY(str) {
  const parts = str.split("/");
  const d = parseInt(parts[0], 10);
  const m = parseInt(parts[1], 10);
  const y = parseInt(parts[2], 10);
  return new Date(y, m - 1, d);
}

function buildSeasonsTable() {
  const sorted = seasonEvents.slice().sort((a,b) => parseDMY(a.greg) - parseDMY(b.greg));
  const tbody = document.getElementById('seasonsBody');
  if (!tbody) return;
  tbody.innerHTML = "";
  for (const ev of sorted) {
    const tr = document.createElement('tr');

    const tdType = document.createElement('td');
    const badge = document.createElement('span');
    badge.className = 'badge ' + (ev.type === 'Ù…ÙˆØ³Ù…' ? 'badge-season' : 'badge-rukood');
    const dot = document.createElement('span');
    dot.className = 'dot';
    const label = document.createElement('span');
    label.textContent = ev.type === 'Ù…ÙˆØ³Ù…' ? 'Ù…ÙˆØ³Ù… / Ø¥Ø¬Ø§Ø²Ø©' : 'Ø¯Ø±Ø§Ø³Ø© / Ø¯ÙˆØ§Ù…';
    badge.appendChild(dot);
    badge.appendChild(label);
    tdType.appendChild(badge);

    const tdTitle = document.createElement('td');
    tdTitle.className = 'event-title';
    tdTitle.textContent = ev.title;

    const tdHijri = document.createElement('td');
    tdHijri.textContent = ev.hijri;

    const tdGreg = document.createElement('td');
    tdGreg.textContent = ev.greg;

    tr.appendChild(tdType);
    tr.appendChild(tdTitle);
    tr.appendChild(tdHijri);
    tr.appendChild(tdGreg);
    tbody.appendChild(tr);
  }
}

window.addEventListener('load', function() {
  showFrame('compare'); // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª
  buildSeasonsTable();
});
</script>
</head>
<body>

<div id="switchBar">
  <button id="btnCompare" class="switchBtn" onclick="showFrame('compare')">
    <span class="icon">ğŸ“Š</span><span>Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª</span>
  </button>
  <button id="btnBooking" class="switchBtn inactive" onclick="showFrame('booking')">
    <span class="icon">ğŸ’°</span><span>Ø­Ø§Ø³Ø¨Ø© Ø£Ø³Ø¹Ø§Ø± Ø¨ÙˆÙƒÙŠÙ†Ø¬</span>
  </button>
  <button id="btnSeasons" class="switchBtn inactive" onclick="showFrame('seasons')">
    <span class="icon">ğŸ‰</span><span>Ø§Ù„Ù…ÙˆØ§Ø³Ù… ÙˆØ§Ù„Ø§Ø¹ÙŠØ§Ø¯</span>
  </button>
</div>

<div class="frame-wrapper">
  <iframe id="frameCompare" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ar&quot; dir=&quot;rtl&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot; /&gt;
  &lt;title&gt;Ø§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø´ÙØ§Ù (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø±)&lt;/title&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; 
  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js&quot;&gt;&lt;/script&gt;
  &lt;style&gt;
    /* === GLOBAL STYLES &amp; STABLE COLOR PALETTE (DAY THEME â€“ ÙƒÙ…Ø§ Ù‡Ùˆ) === */
    :root { 
      --bg-dark: #0B2447; /* Deep Navy Blue (For page background) */
      --bg-card: #F9FAFB; /* Card Background */
      --accent-blue: #06B6D4; /* Royal Cyan */
      --color-success: #10B981; /* Emerald Green */
      --color-danger: #EF4444; /* Sunset Red */
      --text-main: #1e293b; 
      --text-soft: #64748b;
      --color-border: #94a3b8;
      
      /* Input Colors */
      --color-vacant-bg: #E6FFFA; 
      --color-cleaning-bg: #FFFBEB; 
      --color-dep-bg: #EFF6FF; 
      --color-maint-bg: #F1F5F9; 
    }

    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      color: var(--text-main); 
      padding: 30px 15px; 
      margin: 0;
      background: radial-gradient(circle at top left, #14406e 0%, var(--bg-dark) 50%, #05162a 100%);
      transition: background 0.25s ease, color 0.25s ease;
    }

    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: var(--bg-card); 
      padding: 30px; 
      border-radius: 16px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.2); 
      position: relative;
      transition: background-color 0.25s ease, color 0.25s ease, box-shadow 0.25s ease;
      /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙˆÙ‚ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø«Ø§Ø¨Øª */
      padding-bottom: 70px;
    }
    
    h1 { text-align: center; margin-bottom: 5px; color: var(--text-main); }
    .subtitle { text-align: center; font-size: 0.95rem; color: var(--text-soft); margin-bottom: 25px; line-height: 1.5; }

    .note { font-size: 0.8rem; color: var(--text-soft); }

    /* === THEME TOGGLE BUTTON (ICON) === */
    .top-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-bottom: 10px;
    }

    .theme-toggle {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: #f9fafb;
      box-shadow: 0 2px 6px rgba(15,23,42,0.2);
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.08s ease, border-color 0.2s ease;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(15,23,42,0.25);
    }

    .theme-icon {
      font-size: 1.1rem;
      line-height: 1;
    }
    
    /* Mode Toggle Styles */
    .mode-toggle { text-align: center; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; }
    .mode-toggle button {
        background: #F1F5F9;
        color: var(--text-soft);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
        margin: 0 5px;
        font-size: 1rem;
    }
    .mode-toggle button.active {
        background: var(--accent-blue);
        color: #fff;
        box-shadow: 0 4px 10px rgba(6, 182, 212, 0.4);
    }

    /* Controls and Buttons */
    .upload-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: end; background: var(--color-maint-bg); padding: 20px; border-radius: 12px; }
    input[type=&quot;file&quot;] { width: 100%; font-size: 0.9rem; }
    
    .action-button { 
        background: var(--color-success); 
        color: white; 
        border: none; 
        padding: 12px 24px; 
        border-radius: 8px; 
        cursor: pointer; 
        margin-top: 20px; 
        display: block; 
        width: 100%; 
        font-size: 1.1rem; 
        font-weight: bold;
        transition: background 0.2s;
    }
    .action-button:hover { background: #0c9c6f; }

    /* === Sign-off Styles (Ø§Ù„ØªÙˆÙ‚ÙŠØ¹) - Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙˆØ§Ø±ØªÙØ§Ø¹ 1 Ø³Ù… === */
    .sign-off {
      text-align: center;
      padding: 0; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ */
      margin: 20px auto 0; 
      width: 100%;
      max-width: 1200px;
      line-height: 1; 
      font-size: 0.75rem; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
    }
    
    .sign-off-item {
        display: inline-block;
        padding: 0 5px;
        color: var(--text-soft); /* ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ */
    }
    
    /* Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ (10 Ø³Ù… Ø¹Ø±Ø¶ØŒ 1 Ø³Ù… Ø§Ø±ØªÙØ§Ø¹ ØªÙ‚Ø±ÙŠØ¨ÙŠ) */
    .sign-off.fixed-bottom {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
        background: var(--bg-card); 
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        padding: 8px 15px; /* ØªØ¨Ø§Ø¹Ø¯ Ø¯Ø§Ø®Ù„ÙŠ Ù‚Ù„ÙŠÙ„ Ø¬Ø¯Ø§Ù‹ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ø±ØªÙØ§Ø¹ 1 Ø³Ù… */
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        width: 380px; /* ØªØ¹ÙŠÙŠÙ† Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù€ 10 Ø³Ù… */
        max-width: 90%; 
        margin: 0; 
        height: auto; 
    }

    /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ù„Ù… ØªØ¹Ø¯ Ù…ÙˆØ¬ÙˆØ¯Ø© */
    .sign-off-hr { display: none; }
    
    .sign-off b {
      color: var(--text-main);
      font-size: 0.85rem; 
      font-weight: bold;
    }
    .sign-off-email {
      font-family: monospace;
      color: var(--accent-blue);
      font-size: 0.75rem;
    }

    /* Results and Section Titles */
    .results-area { margin-top: 30px; display: none; }
    .results-area.visible { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .section-title { font-size: 1.1rem; font-weight: 800; margin: 20px 0 10px; padding-right: 10px; border-right: 4px solid var(--accent-blue); }
    
    /* Tables and Inputs Structure */
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.85rem; background: #fff; border: 1px solid #e2e8f0; }
    th, td { border: 1px solid #e2e8f0; padding: 10px; vertical-align: top; }
    th { background: #f8fafc; font-weight: 700; text-align: center; color: #334155; }
    td { text-align: center; }

    /* Manual Input Styles */
    .mode-content.hidden { display: none; }
    .manual-section { border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    
    /* Input Table Styling (Color) */
    .th-vacant { background: var(--color-vacant-bg); color: var(--color-success); }
    .th-cleaning { background: var(--color-cleaning-bg); color: #a16207; } 
    .th-dep { background: var(--color-dep-bg); color: var(--accent-blue); }
    .th-maint { background: var(--color-maint-bg); color: var(--text-soft); }

    .input-table td { background: #ffffff; border: 1px solid #e2e8f0; padding: 5px; } 
    .type-cell { font-weight: bold; text-align: right !important; padding-right: 15px !important; }

    /* Enhanced Input Box Style (High Contrast) */
    .data-input { 
      width: 90%; padding: 10px 6px; border: 2px solid var(--color-border); border-radius: 6px; 
      font-size: 1.1rem; font-weight: bold; text-align: center; display: block; margin: 5px auto;
      transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s;
      background-color: #f7f9fb; color: var(--text-main);
    }
    .data-input:focus { border-color: var(--accent-blue); outline: none; box-shadow: 0 0 5px rgba(6, 182, 212, 0.5); background-color: #ffffff; }

    /* Output Specific Styles */
    .badge { padding: 4px 8px; border-radius: 99px; font-weight: bold; font-size: 0.75rem; }
    .bg-green { background: var(--color-vacant-bg); color: var(--color-success); } 
    .bg-red { background: #fee2e2; color: var(--color-danger); }   
    .bg-gray { background: var(--color-maint-bg); color: var(--text-soft); } 
    .bg-blue { background: var(--color-dep-bg); color: var(--accent-blue); }
    .guest-item { display: block; text-align: right; font-size: 0.75rem; margin-bottom: 4px; border-bottom: 1px dashed #eee; padding-bottom: 2px; }
    .pay-info { font-family: monospace; background: #eff6ff; color: #1e40af; padding: 1px 4px; border-radius: 3px; margin-right: 5px; }

    .actions-row { margin-top: 15px; text-align: center; }
    .actions-row button { 
        padding: 8px 15px; margin: 0 5px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s;
        border: 1px solid var(--color-border);
    }
    .btn-export { background: #e0f2fe; color: var(--accent-blue); }
    .btn-print { background: #f8fafc; color: var(--text-soft); }

    /* Error message (ÙƒØ§Ù†Øª ØºÙŠØ± Ù…Ø¹Ø±ÙØ© ÙÙŠ CSS) */
    .error-msg {
      color: var(--color-danger);
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 8px;
      padding: 10px;
      font-size: 0.85rem;
      display: none;
      margin-top: 10px;
    }

    /* === DARK MODE OVERRIDES === */
    body.theme-dark {
      background: radial-gradient(circle at top left, #020617 0%, #020617 50%, #000000 100%);
      color: #e5e7eb;
    }

    body.theme-dark .container {
      background: #020617;
      color: #e5e7eb;
      box-shadow:
        0 26px 60px rgba(15,23,42,0.9),
        0 0 0 1px rgba(30,64,175,0.8);
    }

    body.theme-dark h1 {
      color: #e5e7eb;
    }

    body.theme-dark .subtitle {
      color: #9ca3af;
    }

    body.theme-dark .section-title {
      color: #e5e7eb;
      border-right-color: #38bdf8;
    }

    body.theme-dark .mode-toggle {
      border-bottom-color: #1f2937;
    }

    body.theme-dark .mode-toggle button {
      background: #020617;
      color: #9ca3af;
      border: 1px solid #1f2937;
    }

    body.theme-dark .mode-toggle button.active {
      background: #1d4ed8;
      color: #e5e7eb;
      box-shadow: 0 4px 16px rgba(37,99,235,0.6);
      border-color: #1d4ed8;
    }

    body.theme-dark .upload-controls {
      background: #020617;
      border: 1px solid #1f2937;
    }

    body.theme-dark input[type=&quot;file&quot;] {
      background: #020617;
      color: #e5e7eb;
      border-color: #334155;
    }

    body.theme-dark input[type=&quot;file&quot;]:hover {
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.7);
      background: #020617;
    }

    body.theme-dark .manual-section {
      background: #020617;
      border-color: #1f2937;
    }

    body.theme-dark table {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.theme-dark th {
      background: #111827;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.theme-dark td {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.theme-dark .input-table td {
      background: #020617;
    }

    body.theme-dark .data-input {
      background-color: #020617;
      color: #e5e7eb;
      border-color: #334155;
    }

    body.theme-dark .data-input:focus {
      background-color: #020617;
      box-shadow:
        0 0 0 1px rgba(37,99,235,0.8),
        0 0 18px rgba(37,99,235,0.7);
    }

    body.theme-dark .badge.bg-green {
      background: rgba(22,163,74,0.15);
      color: #bbf7d0;
    }

    body.theme-dark .badge.bg-red {
      background: rgba(220,38,38,0.15);
      color: #fecaca;
    }

    body.theme-dark .badge.bg-gray {
      background: rgba(148,163,184,0.2);
      color: #e5e7eb;
    }

    body.theme-dark .badge.bg-blue {
      background: rgba(37,99,235,0.18);
      color: #bfdbfe;
    }

    body.theme-dark .guest-item {
      border-bottom-color: #374151;
      color: #e5e7eb;
    }

    body.theme-dark .pay-info {
      background: #1d4ed8;
      color: #e5e7eb;
    }

    body.theme-dark .btn-export {
      background: radial-gradient(circle at top left, rgba(34,197,94,0.2), #020617);
      color: #bbf7d0;
      border-color: #4ade80;
    }

    body.theme-dark .btn-print {
      background: radial-gradient(circle at top left, rgba(96,165,250,0.2), #020617);
      color: #bfdbfe;
      border-color: #60a5fa;
    }

    body.theme-dark .action-button {
      box-shadow:
        0 16px 40px rgba(22,163,74,0.7),
        0 0 0 1px rgba(15,23,42,0.9);
    }

    body.theme-dark .error-msg {
      background: rgba(127,29,29,0.9);
      border-color: #fecaca;
      color: #fecaca;
    }

    body.theme-dark .theme-toggle {
      background: #020617;
      border-color: #334155;
      box-shadow: 0 2px 8px rgba(15,23,42,0.9);
    }

    body.theme-dark .theme-icon {
      color: #fde68a;
    }
    
    /* === DARK MODE OVERRIDES (Sign-off) === */
    body.theme-dark .sign-off-item {
      color: #9ca3af;
    }
    body.theme-dark .sign-off b {
      color: #e5e7eb;
    }
    body.theme-dark .sign-off-email {
      color: #38bdf8;
    }
    body.theme-dark .sign-off.fixed-bottom {
        background: #020617; 
        box-shadow: 0 -2px 10px rgba(30,64,175,0.8);
    }

    /* === MEDIA QUERIES for Responsiveness / Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª === */
    @media (max-width: 768px) {
        body { 
            padding: 15px; 
        }
        .container { 
            padding: 20px; 
            border-radius: 10px;
            padding-bottom: 70px; /* Ù…Ø³Ø§ÙØ© Ø³ÙÙ„ÙŠØ© Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }
        .upload-controls { 
            grid-template-columns: 1fr; 
            gap: 10px;
        }
        .mode-toggle button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        .action-button {
            font-size: 1rem;
        }
        table {
          font-size: 0.8rem;
        }
        th, td {
          padding: 8px 5px;
        }
        .sign-off.fixed-bottom {
            padding: 8px 10px;
            box-shadow: 0 -1px 5px rgba(0,0,0,0.15);
        }
    }


    /* === PRINT STYLES === */
    @media print {
      /* ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Landscape */
      @page { size: A4 landscape; margin: 15mm; } 
      body { background: #fff !important; margin: 0; padding: 0; }
      .container { box-shadow: none !important; width: 100% !important; max-width: none !important; background: #fff !important; color: #000 !important; padding-bottom: 10px !important; }

      .top-bar,
      .mode-toggle,
      .subtitle,
      .upload-controls,
      #errorArea, 
      #tableBooking,
      #tableNazeel,
      .action-button,
      .actions-row,
      .sign-off.fixed-bottom, /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø«Ø§Ø¨Øª */
      .section-title:not(:last-of-type) { 
        display: none !important; 
      }
      
      #output { display: block !important; margin-top: 0; }
      #tableCompare { width: 100%; margin-top: 20px; }
      .results-table th, .results-table td,
      table th, table td {
        border: 1px solid #333 !important; padding: 8px; background: #fff !important; color: #000 !important;
      }
      .results-table th, table th { background-color: #eee !important; }
      .badge { border: 1px solid #333; color: #000; background: none !important; }
      
      /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ ÙƒØ¬Ø²Ø¡ Ù…Ù† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹ */
      .sign-off:not(.fixed-bottom) {
        display: block !important;
        position: relative !important;
        margin-top: 20px !important; 
        color: #000 !important;
        padding: 0;
        line-height: 1.2;
        font-size: 0.75rem;
      }
      .sign-off-item {
        color: #000 !important;
        font-size: 0.75rem !important;
      }
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;top-bar&quot;&gt;
    &lt;div id=&quot;themeToggle&quot; class=&quot;theme-toggle&quot; title=&quot;ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹&quot;&gt;
      &lt;span id=&quot;themeIcon&quot; class=&quot;theme-icon&quot;&gt;ğŸŒ™&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;h1&gt;Ø§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø´ÙØ§Ù (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯)&lt;/h1&gt;
  &lt;div class=&quot;subtitle&quot;&gt;
    Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù„Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ) Ø£Ùˆ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©).
  &lt;/div&gt;

  &lt;div class=&quot;mode-toggle&quot;&gt;
    &lt;button id=&quot;toggleUpload&quot; class=&quot;active&quot; onclick=&quot;switchMode(&#x27;upload&#x27;)&quot;&gt;Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª&lt;/button&gt;
    &lt;button id=&quot;toggleManual&quot; onclick=&quot;switchMode(&#x27;manual&#x27;)&quot;&gt;Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ&lt;/button&gt;
  &lt;/div&gt;

  &lt;div id=&quot;errorArea&quot; class=&quot;error-msg&quot;&gt;&lt;/div&gt;
  
  &lt;div id=&quot;uploadMode&quot; class=&quot;mode-content visible&quot;&gt;
    &lt;div class=&quot;upload-controls&quot;&gt;
      &lt;div&gt;
        &lt;label style=&quot;font-weight:bold; display:block; margin-bottom:5px&quot;&gt;Ù…Ù„Ù Ø¨ÙˆÙƒÙŠÙ†Ø¬ (Booking)&lt;/label&gt;
        &lt;input type=&quot;file&quot; id=&quot;fileBooking&quot; accept=&quot;.xls,.xlsx,.csv&quot;&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label style=&quot;font-weight:bold; display:block; margin-bottom:5px&quot;&gt;Ù…Ù„Ù Ù†Ø²ÙŠÙ„ (Nazeel)&lt;/label&gt;
        &lt;input type=&quot;file&quot; id=&quot;fileNazeel&quot; accept=&quot;.xls,.xlsx,.csv&quot;&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div id=&quot;manualMode&quot; class=&quot;mode-content hidden&quot;&gt;
    &lt;p class=&quot;note&quot; style=&quot;text-align:center;&quot;&gt;ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù„ÙƒÙ„ Ù†ÙˆØ¹ ÙˆØ­Ø¯Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØªÙ‚Ø±ÙŠØ±. Ø§Ø¶ØºØ· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ù„Ù„ÙƒØªØ§Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©.&lt;/p&gt;
    
    &lt;div class=&quot;manual-section&quot;&gt;
      &lt;div class=&quot;section-title&quot;&gt;ğŸ“¦ ØªØ­Ù„ÙŠÙ„ Ù†Ø²ÙŠÙ„ (Ø§Ù„Ù…Ø®Ø²ÙˆÙ†)&lt;/div&gt;
      &lt;table class=&quot;input-table&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th style=&quot;width: 30%;&quot;&gt;Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©&lt;/th&gt;
            &lt;th class=&quot;th-vacant&quot;&gt;Ø´Ø§ØºØ± (Ø£Ø®Ø¶Ø±)&lt;/th&gt;
            &lt;th class=&quot;th-cleaning&quot;&gt;Ù†Ø¸Ø§ÙØ© (Ø£ØµÙØ±)&lt;/th&gt;
            &lt;th class=&quot;th-dep&quot;&gt;Ù…ØªÙˆÙ‚Ø¹ Ø®Ø±ÙˆØ¬ Ø§Ù„ÙŠÙˆÙ… (Ø£Ø²Ø±Ù‚)&lt;/th&gt;
            &lt;th class=&quot;th-maint&quot;&gt;ØµÙŠØ§Ù†Ø© (Ø±Ù…Ø§Ø¯ÙŠ)&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody id=&quot;nazeel-inputs&quot;&gt;
          &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;div class=&quot;manual-section&quot;&gt;
      &lt;div class=&quot;section-title&quot;&gt; Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ø¨ÙˆÙƒÙŠÙ†Ø¬)&lt;/div&gt;
      &lt;p class=&quot;note&quot;&gt;Ø£Ø¯Ø®Ù„ ØµØ§ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ ÙˆØµÙˆÙ„Ù‡Ø§ (ØªÙ… ØªØµÙÙŠØ© Ø§Ù„ÙˆØ§ØµÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆØ§Ù„Ù…Ù„ØºÙŠ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ø²ÙŠÙ„).&lt;/p&gt;
      &lt;table class=&quot;input-table&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th style=&quot;width: 70%;&quot;&gt;Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©&lt;/th&gt;
            &lt;th&gt;Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody id=&quot;booking-inputs&quot;&gt;
          &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;button id=&quot;mainAnalyzeButton&quot; class=&quot;action-button&quot; onclick=&quot;unifiedAnalysis()&quot;&gt;ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©&lt;/button&gt;

  &lt;div id=&quot;output&quot; class=&quot;results-area&quot;&gt;
    &lt;div class=&quot;section-title&quot;&gt;1. ØªØ­Ù„ÙŠÙ„ Ø¨ÙˆÙƒÙŠÙ†Ø¬ (Ø§Ù„Ø­Ø±ÙƒØ©)&lt;/div&gt;
    &lt;div id=&quot;tableBooking&quot;&gt;&lt;/div&gt;

    &lt;div class=&quot;section-title&quot;&gt;2. ØªØ­Ù„ÙŠÙ„ Ù†Ø²ÙŠÙ„ (Ø§Ù„Ù…Ø®Ø²ÙˆÙ†)&lt;/div&gt;
    &lt;div id=&quot;tableNazeel&quot;&gt;&lt;/div&gt;

    &lt;div class=&quot;section-title&quot;&gt;3. Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ÙˆØ§Ù„ØªÙˆØµÙŠØ©&lt;/div&gt;
    &lt;div id=&quot;tableCompare&quot;&gt;&lt;/div&gt;
    
    &lt;div class=&quot;actions-row&quot;&gt;
        &lt;button class=&quot;btn-export&quot; onclick=&quot;exportComparisonToExcel()&quot;&gt;ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Excel)&lt;/button&gt;
        &lt;button class=&quot;btn-print&quot; onclick=&quot;window.print()&quot;&gt;ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;sign-off&quot;&gt;
  &lt;span class=&quot;sign-off-item&quot;&gt;ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-name&quot;&gt;| &lt;b&gt;Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&lt;/b&gt;&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-email&quot;&gt;| 77aayy@gmail.com&lt;/span&gt;
&lt;/div&gt;
&lt;script&gt;
let currentMode = &#x27;upload&#x27;; 
const CANONICAL_TYPES = [
  &quot;Ø´Ù‚Ø© Ø¨ØºØ±ÙØªÙŠ Ù†ÙˆÙ…&quot;, &quot;Ø´Ù‚Ø© Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±&quot;, &quot;Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù…Ø§Ù…ÙŠ&quot;, &quot;ØºØ±ÙØ© ÙƒÙŠÙ†Ø¬ Ù…ÙØ±Ø¯&quot;, &quot;ØºØ±ÙØ© ØªØ¤Ù… Ø®Ù„ÙÙŠØ©&quot;, &quot;VIP&quot;
];
const CANCEL_FLAGS = [&quot;cancel&quot;, &quot;cancelled&quot;, &quot;cancelled_by_guest&quot;, &quot;Ù…Ù„ØºÙŠ&quot;, &quot;ÙƒÙ†Ø³Ù„&quot;];

window.nazeelLastRunData = null;
window.bookingLastRunData = null;

const THEME_KEY = &#x27;auditThemeMode&#x27;;

/* === THEME HANDLING === */
function applyTheme(theme) {
  const body = document.body;
  const icon = document.getElementById(&#x27;themeIcon&#x27;);
  if (!icon) return;
  if (theme === &#x27;dark&#x27;) {
    body.classList.add(&#x27;theme-dark&#x27;);
    icon.textContent = &#x27;â˜€ï¸&#x27;;
  } else {
    body.classList.remove(&#x27;theme-dark&#x27;);
    icon.textContent = &#x27;ğŸŒ™&#x27;;
  }
}

/* =========================================================================
   === UTILITY FUNCTIONS (UNMODIFIED LOGIC) ===
   ========================================================================= */

function getSmartRecommendation(diff) {
    if (diff === 1) {
        return &#x27;âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 1. ÙˆÙ„Ùˆ Ø£Ø¬Ù‘Ø±Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù‚ÙÙ„Ù‡Ø§ Ø¨ÙˆÙƒÙŠÙ†Ø¬&#x27;;
    } else if (diff === 2) {
        return &#x27;âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 1 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„&#x27;;
    } else if (diff === 3) {
        return &#x27;âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 2 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„&#x27;;
    } else if (diff === 4) {
        return &#x27;âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 4. Ø§Ù„Ø´Ø§ØºØ± ÙƒØªÙŠØ±&#x27;;
    } else if (diff &gt; 4) {
        const suggestedOpen = diff - 1; 
        return `âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ ${suggestedOpen} Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„. Ø£Ù†Øª ÙÙŠ Ø§Ù„Ø£Ù…Ø§Ù†`;
    }
    return &#x27;âœ… Ø§ÙØªØ­ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØºØ±Ù&#x27;;
}

function mapUnit(raw) {
  if (!raw) return null;
  const s = raw.toString().trim();
  
  if (s.includes(&quot;ØºØ±ÙØªÙŠÙ†&quot;) || s.includes(&quot;ØºØ±ÙØªÙŠ&quot;)) return &quot;Ø´Ù‚Ø© Ø¨ØºØ±ÙØªÙŠ Ù†ÙˆÙ…&quot;;
  if (s.includes(&quot;ØµØ§Ù„Ø© Ù…Ø·Ù„Ù‡&quot;) || s.includes(&quot;ØµØ§Ù„Ø© Ù…Ø·Ù„Ø©&quot;) || s.includes(&quot;Ù†ÙˆÙ… Ù…Ø·Ù„Ø©&quot;) || s.includes(&quot;Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø©&quot;) || s.includes(&quot;Sea View&quot;)) return &quot;Ø´Ù‚Ø© Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±&quot;;
  if (s.includes(&quot;Ø³ØªÙˆØ¯ÙŠÙˆ&quot;) &amp;&amp; s.includes(&quot;Ø§Ù…Ø§Ù…ÙŠ&quot;)) return &quot;Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù…Ø§Ù…ÙŠ&quot;;
  if (s.toUpperCase().includes(&quot;VIP&quot;)) return &quot;VIP&quot;;
  if ((s.includes(&quot;ÙƒÙŠÙ†Ø¬&quot;) || s.includes(&quot;King&quot;)) &amp;&amp; !s.includes(&quot;ØªØ¤Ù…&quot;) &amp;&amp; !s.includes(&quot;Twin&quot;)) return &quot;ØºØ±ÙØ© ÙƒÙŠÙ†Ø¬ Ù…ÙØ±Ø¯&quot;;
  if (s.includes(&quot;ØªØ¤Ù…&quot;) || s.includes(&quot;Twin&quot;)) return &quot;ØºØ±ÙØ© ØªØ¤Ù… Ø®Ù„ÙÙŠØ©&quot;;

  return null;
}

// =========================================================================
// === OUTPUT / DRAWING FUNCTIONS (ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ø§Ù„ØªØ«Ø¨ÙŠØª Ù‡Ù†Ø§) ===
// =========================================================================

function draw(b, n) {
  const outputDiv = document.getElementById(&quot;output&quot;);
  outputDiv.classList.remove(&quot;visible&quot;);
  
  // 1. Booking Output
  let h1 = `&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Ø§Ù„Ù†ÙˆØ¹&lt;/th&gt;&lt;th&gt;Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Expected)&lt;/th&gt;&lt;th&gt;ÙˆØµÙ„ (Arrived)&lt;/th&gt;&lt;th&gt;No Show&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`;
  CANONICAL_TYPES.forEach(t =&gt; {
    const d = b[t];
    if (!d) return; 

    const arrTxt = d.arrived &gt; 0 
      ? `&lt;b&gt;${d.arrived}&lt;/b&gt;` + (d.arrDep &gt; 0 ? `&lt;span style=&quot;font-size:0.7em&quot;&gt; (Ù…Ù†Ù‡Ù… ${d.arrDep} Ø¹Ø±Ø¨ÙˆÙ†)&lt;/span&gt;` : &quot;&quot;) 
      : &quot;0&quot;;
    
    h1 += `&lt;tr&gt;
      &lt;td&gt;${t}&lt;/td&gt;
      &lt;td&gt;${d.expected &gt; 0 ? `&lt;b style=&quot;color:var(--color-danger)&quot;&gt;${d.expected} (OK)&lt;/b&gt;` : &quot;0&quot;} ${d.expList ? `&lt;div&gt;${d.expList.join(&quot;&quot;)}&lt;/div&gt;` : &quot;&quot;}&lt;/td&gt;
      &lt;td&gt;${arrTxt} ${d.arrList ? `&lt;div&gt;${d.arrList.join(&quot;&quot;)}&lt;/div&gt;` : &quot;&quot;}&lt;/td&gt;
      &lt;td&gt;${d.noShow} ${d.nsList ? `&lt;div&gt;${d.nsList.join(&quot;&quot;)}&lt;/div&gt;` : &quot;&quot;}&lt;/td&gt;
    &lt;/tr&gt;`;
  });
  h1 += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
  document.getElementById(&quot;tableBooking&quot;).innerHTML = h1;

  // 2. Nazeel Output
  let h2 = `&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Ø§Ù„Ù†ÙˆØ¹&lt;/th&gt;&lt;th&gt;Ø§Ù„Ø´Ø§ØºØ± Ø§Ù„ÙØ¹Ù„ÙŠ (Ø´Ø§ØºØ± Ùˆ ØªØ­Øª Ø§Ù„Ù†Ø¸Ø§ÙØ©)&lt;/th&gt;&lt;th&gt;Ù…ØªÙˆÙ‚Ø¹ Ø®Ø±ÙˆØ¬ Ø§Ù„ÙŠÙˆÙ…&lt;/th&gt;&lt;th&gt;Ù…ØªØ§Ø­ ØªØ§Ø¬Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ùˆ Ø§ÙˆÙ† Ù„Ø§ÙŠÙ†&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`;
  CANONICAL_TYPES.forEach(t =&gt; {
    const d = n[t];
    if (!d) return;

    const vacantCount = d.vac || d.vacant || 0; 
    const depCount = d.dep || d.depToday || 0;
    const avail = d.avail || (vacantCount + Math.round(depCount * 0.40));
    
    h2 += `&lt;tr&gt;
      &lt;td&gt;${t}&lt;/td&gt;
      &lt;td&gt;&lt;b&gt;${vacantCount}&lt;/b&gt; ${d.vacList ? `&lt;div&gt;${d.vacList.join(&quot;&quot;)}&lt;/div&gt;` : &quot;&quot;}&lt;/td&gt;
      &lt;td&gt;${depCount} ${d.depList ? `&lt;div&gt;${d.depList.join(&quot;&quot;)}&lt;/div&gt;` : &quot;&quot;}&lt;/td&gt;
      &lt;td&gt;&lt;span class=&quot;badge bg-blue&quot; style=&quot;font-size:0.9rem&quot;&gt;${avail}&lt;/span&gt;&lt;/td&gt;
    &lt;/tr&gt;`;
  });
  h2 += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
  document.getElementById(&quot;tableNazeel&quot;).innerHTML = h2;

  // 3. Compare Output
  let h3 = `&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Ø§Ù„Ù†ÙˆØ¹&lt;/th&gt;&lt;th&gt;Ù…ØªØ§Ø­ ØªØ§Ø¬Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ùˆ Ø§ÙˆÙ† Ù„Ø§ÙŠÙ†&lt;/th&gt;&lt;th&gt;Ø§Ù„Ù…Ø­Ø¬ÙˆØ² Ù„Ø¨ÙˆÙƒÙŠÙ†Ø¬&lt;/th&gt;&lt;th&gt;Ø§Ù„ÙØ±Ù‚&lt;/th&gt;&lt;th&gt;Ø§Ù„ØªÙˆØµÙŠØ©&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`;
  CANONICAL_TYPES.forEach(t =&gt; {
    const nData = n[t];
    const bData = b[t];

    if (!nData &amp;&amp; !bData) return;

    const vacantCount = nData ? (nData.vac || nData.vacant || 0) : 0;
    const depCount = nData ? (nData.dep || nData.depToday || 0) : 0;

    const avail = nData ? (nData.avail || (vacantCount + Math.round(depCount * 0.40))) : 0;
    const req = bData ? bData.expected : 0;
    
    if (avail === 0 &amp;&amp; req === 0) return;

    const diff = avail - req;
    let decision = &#x27;&#x27;;
    let badge = &#x27;&#x27;;
    let badgeClass = &#x27;&#x27;;

    if (diff &gt; 0) {
        decision = getSmartRecommendation(diff);
        badge = `+${diff} ÙØ§Ø¦Ø¶`;
        badgeClass = &#x27;bg-green&#x27;;
    } else if (diff &lt; 0) {
        decision = &#x27;â›” Ø£ØºÙ„Ù‚ Ø§Ù„Ø¨ÙŠØ¹ ÙÙˆØ±Ø§Ù‹&#x27;;
        badge = `${diff} Ø¹Ø¬Ø²`;
        badgeClass = &#x27;bg-red&#x27;;
    } else {
        decision = &#x27;â¸ï¸ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ&#x27;;
        badge = &#x27;Ù…ØªÙˆØ§Ø²Ù†&#x27;;
        badgeClass = &#x27;bg-gray&#x27;;
    }
    
    h3 += `&lt;tr&gt;
      &lt;td&gt;${t}&lt;/td&gt;
      &lt;td&gt;${avail}&lt;/td&gt;
      &lt;td&gt;${req}&lt;/td&gt;
      &lt;td&gt;&lt;span class=&quot;badge ${badgeClass}&quot;&gt;${badge}&lt;/span&gt;&lt;/td&gt;
      &lt;td style=&quot;font-weight:bold; color:${diff&lt;0?&#x27;var(--color-danger)&#x27;:&#x27;var(--color-success)&#x27;}&quot;&gt;${decision}&lt;/td&gt;
    &lt;/tr&gt;`;
  });
  h3 += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
  document.getElementById(&quot;tableCompare&quot;).innerHTML = h3;

  outputDiv.classList.add(&quot;visible&quot;);
  
  // === Ø¥Ø¶Ø§ÙØ© Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ø¹Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===
  document.querySelector(&#x27;.sign-off&#x27;).classList.add(&#x27;fixed-bottom&#x27;);
}

// =========================================================================
// === FILE EXPORT LOGIC (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹) ===
// =========================================================================

function exportComparisonToExcel() {
    const wb = XLSX.utils.book_new();
    const wsData = [];
    
    if (!window.nazeelLastRunData || !window.bookingLastRunData) {
        alert(&quot;ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ù†Ø§Ø¬Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.&quot;);
        return;
    }

    const headers = [&quot;Ø§Ù„Ù†ÙˆØ¹&quot;, &quot;Ù…ØªØ§Ø­ ØªØ§Ø¬Ø± (Avail)&quot;, &quot;Ø§Ù„Ù…Ø­Ø¬ÙˆØ² Ù„Ø¨ÙˆÙƒÙŠÙ†Ø¬&quot;, &quot;Ø§Ù„ÙØ±Ù‚&quot;, &quot;Ø§Ù„ØªÙˆØµÙŠØ©&quot;];
    wsData.push(headers);

    CANONICAL_TYPES.forEach(t =&gt; {
        const nData = window.nazeelLastRunData[t];
        const bData = window.bookingLastRunData[t];

        const vacantCount = nData ? (nData.vac || nData.vacant || 0) : 0;
        const depCount = nData ? (nData.dep || nData.depToday || 0) : 0;
        const avail = nData ? (nData.avail || (vacantCount + Math.round(depCount * 0.40))) : 0;
        const req = bData ? bData.expected : 0;
        const diff = avail - req;

        if (avail === 0 &amp;&amp; req === 0) return;

        let recommendation = &#x27;&#x27;;
        if (diff &gt; 0) {
            recommendation = getSmartRecommendation(diff);
        } else if (diff &lt; 0) {
            recommendation = &#x27;â›” Ø£ØºÙ„Ù‚ Ø§Ù„Ø¨ÙŠØ¹ ÙÙˆØ±Ø§Ù‹&#x27;;
        } else {
            recommendation = &#x27;â¸ï¸ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ&#x27;;
        }

        wsData.push([
            t, 
            avail, 
            req, 
            diff, 
            recommendation.replace(/&lt;[^&gt;]*&gt;?/gm, &#x27;&#x27;)
        ]);
    });
    
    // === Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø¥ÙƒØ³Ù„ ===
    wsData.push([]);
    wsData.push([]);
    wsData.push([&quot;ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©: Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&quot;, &quot;77aayy@gmail.com&quot;]);
    // ===================================


    const ws = XLSX.utils.aoa_to_sheet(wsData);
    XLSX.utils.book_append_sheet(wb, ws, &quot;Final_Audit_Comparison&quot;);

    const wscols = [
        { wch: 30 }, { wch: 15 }, { wch: 15 }, { wch: 10 }, { wch: 45 }
    ];
    ws[&#x27;!cols&#x27;] = wscols;

    XLSX.writeFile(wb, &quot;Final_Audit_Comparison.xlsx&quot;);
}


// =========================================================================
// === MODE SWITCHING &amp; UNIFIED CONTROL (ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª Ù‡Ù†Ø§) ===
// =========================================================================

function switchMode(mode) {
    currentMode = mode;
    
    document.getElementById(&#x27;uploadMode&#x27;).classList.toggle(&#x27;visible&#x27;, mode === &#x27;upload&#x27;);
    document.getElementById(&#x27;uploadMode&#x27;).classList.toggle(&#x27;hidden&#x27;, mode !== &#x27;upload&#x27;);
    
    document.getElementById(&#x27;manualMode&#x27;).classList.toggle(&#x27;visible&#x27;, mode === &#x27;manual&#x27;);
    document.getElementById(&#x27;manualMode&#x27;).classList.toggle(&#x27;hidden&#x27;, mode !== &#x27;manual&#x27;);

    document.getElementById(&#x27;toggleUpload&#x27;).classList.toggle(&#x27;active&#x27;, mode === &#x27;upload&#x27;);
    document.getElementById(&#x27;toggleManual&#x27;).classList.toggle(&#x27;active&#x27;, mode === &#x27;manual&#x27;);

    document.getElementById(&quot;errorArea&quot;).style.display = &quot;none&quot;;
    document.getElementById(&quot;output&quot;).classList.remove(&quot;visible&quot;);
    
    // === Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===
    document.querySelector(&#x27;.sign-off&#x27;).classList.remove(&#x27;fixed-bottom&#x27;); 
}

function unifiedAnalysis() {
    if (currentMode === &#x27;upload&#x27;) {
        runAudit();
    } else {
        analyzeManualData();
    }
}

// =========================================================================
// === MANUAL INPUT UX FUNCTIONS ===
// =========================================================================

function enforceDigits(input) {
    input.value = input.value.replace(/[^0-9]/g, &#x27;&#x27;); 
}
function clearIfZero(input) {
    if (input.value === &#x27;0&#x27;) {
        input.value = &#x27;&#x27;;
    }
}
function setZeroIfEmpty(input) {
    if (input.value.trim() === &#x27;&#x27;) {
        input.value = &#x27;0&#x27;;
    }
}

function initializeFixedInputTables() {
    const nazeelContainer = document.getElementById(&#x27;nazeel-inputs&#x27;);
    const bookingContainer = document.getElementById(&#x27;booking-inputs&#x27;);
    if(nazeelContainer.children.length &gt; 0) return; 

    let id = 0; 
    CANONICAL_TYPES.forEach(type =&gt; {
        const inputEvents = `oninput=&quot;enforceDigits(this)&quot; onfocus=&quot;clearIfZero(this)&quot; onblur=&quot;setZeroIfEmpty(this)&quot;`;

        const nRow = nazeelContainer.insertRow();
        nRow.dataset.type = type;
        nRow.innerHTML = `
            &lt;td class=&quot;type-cell&quot;&gt;${type}&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;data-input&quot; id=&quot;nazeel_empty_${id}&quot; value=&quot;0&quot; ${inputEvents}&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;data-input&quot; id=&quot;nazeel_cleaning_${id}&quot; value=&quot;0&quot; ${inputEvents}&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;data-input&quot; id=&quot;nazeel_dep_${id}&quot; value=&quot;0&quot; ${inputEvents}&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;data-input&quot; id=&quot;nazeel_maint_${id}&quot; value=&quot;0&quot; ${inputEvents}&gt;&lt;/td&gt;
        `;

        const bRow = bookingContainer.insertRow();
        bRow.dataset.type = type;
        bRow.innerHTML = `
            &lt;td class=&quot;type-cell&quot;&gt;${type}&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; class=&quot;data-input&quot; id=&quot;booking_count_${id}&quot; value=&quot;0&quot; ${inputEvents}&gt;&lt;/td&gt;
        `;
        
        id++; 
    });
}

function analyzeManualData() {
    const errorDiv = document.getElementById(&#x27;errorArea&#x27;);
    errorDiv.style.display = &quot;none&quot;;
    
    const nazeelData = {};
    const bookingData = {};

    CANONICAL_TYPES.forEach((type, id) =&gt; {
        const emptyInput = document.getElementById(`nazeel_empty_${id}`);
        if (emptyInput) {
            const empty = parseInt(emptyInput.value) || 0;
            const cleaning = parseInt(document.getElementById(`nazeel_cleaning_${id}`).value) || 0;
            const depToday = parseInt(document.getElementById(`nazeel_dep_${id}`).value) || 0;
            const maint = parseInt(document.getElementById(`nazeel_maint_${id}`).value) || 0;
            
            const vacant = empty + cleaning;
            const avail = vacant + Math.round(depToday * 0.40);

            nazeelData[type] = { vacant, depToday, avail, maint }; 
        }
    });

    CANONICAL_TYPES.forEach((type, id) =&gt; {
        const countInput = document.getElementById(`booking_count_${id}`);
        if (countInput) {
            const expected = parseInt(countInput.value) || 0;
            bookingData[type] = { expected };
        }
    });

    window.nazeelLastRunData = nazeelData;
    window.bookingLastRunData = bookingData;
    
    const statsB_Manual = {};
    CANONICAL_TYPES.forEach(t =&gt; {
        statsB_Manual[t] = {
            expected: bookingData[t]?.expected || 0,
            arrived: 0, arrDep: 0, noShow: 0,
            expList: [], arrList: [], nsList: [] 
        };
    });
    
    draw(statsB_Manual, nazeelData); 
}


// =========================================================================
// === FILE UPLOAD FUNCTIONS ===
// =========================================================================

function processBooking(rows) {
  const stats = {};
  const ARIVED_TERMS = [&quot;ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯&quot;, &quot;paid&quot;, &quot;Ø¹Ø±Ø¨ÙˆÙ†&quot;, &quot;deposit&quot;, &quot;Ø¨Ø§Ù„ÙƒØ§Ù…Ù„&quot;]; 
  CANONICAL_TYPES.forEach(t =&gt; stats[t] = { expected:0, expList:[], arrived:0, arrList:[], arrDep:0, noShow:0, nsList:[] });

  let idxStatus=-1, idxUnit=-1, idxPayStatus=-1, idxPayRaw=-1, idxGuest=-1, headerRow=-1;

  for(let r=0; r&lt;Math.min(rows.length, 25); r++) {
    const row = rows[r];
    for(let c=0; c&lt;row.length; c++) {
      const val = (row[c]||&quot;&quot;).toString().toLowerCase().trim();
      
      if(val === &quot;status&quot; || val === &quot;Ø§Ù„Ø­Ø§Ù„Ø©&quot; || val.includes(&quot;booking status&quot;)) idxStatus = c;
      if(val.includes(&quot;unit&quot;) || val.includes(&quot;room&quot;) || val.includes(&quot;Ø§Ù„ÙˆØ­Ø¯Ø©&quot;) || val.includes(&quot;accommodation&quot;)) idxUnit = c;
      if(val.includes(&quot;guest&quot;) || val.includes(&quot;Ø§Ù„Ø¶ÙŠÙ&quot;)) idxGuest = c;
      if(val === &quot;payment status&quot; || val === &quot;Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹&quot;) idxPayStatus = c;
      else if((val.includes(&quot;payment&quot;) || val.includes(&quot;Ø§Ù„Ø¯ÙØ¹&quot;)) &amp;&amp; idxPayStatus === -1) idxPayRaw = c;
    }
    if(idxStatus !== -1 &amp;&amp; idxUnit !== -1) { headerRow = r; break; }
  }

  if(headerRow === -1) {
    throw new Error(&quot;Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù„Ù Ø¨ÙˆÙƒÙŠÙ†Ø¬. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø¹Ù…Ø¯Ø© &#x27;Status&#x27; Ùˆ &#x27;Unit/Room Type&#x27;.&quot;);
  }

  const activePayIdx = idxPayStatus !== -1 ? idxPayStatus : idxPayRaw;

  let foundCount = 0;
  for(let r=headerRow+1; r&lt;rows.length; r++) {
    const row = rows[r];
    const status = (row[idxStatus]||&quot;&quot;).toString().toLowerCase().trim();
    const unitStr = (row[idxUnit]||&quot;&quot;).toString();
    const payVal = activePayIdx !== -1 ? (row[activePayIdx]||&quot;&quot;).toString().trim() : &quot;&quot;;
    const guestName = idxGuest !== -1 ? (row[idxGuest]||&quot;&quot;).toString() : &quot;Guest&quot;;

    if(status !== &quot;ok&quot;) continue;
    const rowString = JSON.stringify(row).toLowerCase();
    if(CANCEL_FLAGS.some(f =&gt; rowString.includes(f))) continue;

    foundCount++;

    const units = [];
    unitStr.split(&quot;,&quot;).forEach(p =&gt; {
       const m = p.trim().match(/^(\d+)\s*x\s*(.+)$/i);
       if(m) { for(let i=0; i&lt;+m[1]; i++) units.push(m[2]); } else units.push(p);
    });

    const isExplicitlyPaid = ARIVED_TERMS.some(term =&gt; payVal.toLowerCase().includes(term));
    const isNoShow = payVal === &quot;Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯&quot; || payVal.toLowerCase() === &quot;not paid&quot;;
    const isEmpty = payVal === &quot;&quot;;

    units.forEach(u =&gt; {
      const type = mapUnit(u);
      if(!type) return;

      const debugInfo = `&lt;span class=&quot;guest-item&quot;&gt;${guestName} &lt;span class=&quot;pay-info&quot;&gt;[${payVal || &quot;Empty&quot;}]&lt;/span&gt;&lt;/span&gt;`;

      if (isNoShow) {
        stats[type].noShow++;
        stats[type].nsList.push(debugInfo);

      } else if (isExplicitlyPaid || (!isEmpty &amp;&amp; !isNoShow)) { 
        stats[type].arrived++;
        if(payVal.includes(&quot;Ø¹Ø±Ø¨ÙˆÙ†&quot;) || payVal.toLowerCase().includes(&quot;deposit&quot;)) {
          stats[type].arrDep++;
          stats[type].arrList.push(debugInfo.replace(&quot;]&quot;, &quot; - Ø¹Ø±Ø¨ÙˆÙ†]&quot;));
        } else {
          stats[type].arrList.push(debugInfo);
        }
      } else if (isEmpty) {
        stats[type].expected++;
        stats[type].expList.push(debugInfo);
      }
    });
  }

  if(foundCount === 0) {
    throw new Error(`ÙˆØ¬Ø¯Øª Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Status, Unit) ÙÙŠ Ø§Ù„Ø³Ø·Ø± ${headerRow+1}ØŒ Ù„ÙƒÙ† Ù„Ù… Ø£Ø¬Ø¯ Ø£ÙŠ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø­Ø§Ù„Ø© &quot;OK&quot;. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù„Ù.`);
  }

  return stats;
}

function processNazeel(rows) {
  const todayStr = new Date().toISOString().split(&quot;T&quot;)[0];
  let colStatus=-1, colRoom=-1, colOut=-1, headerRow=-1;

  for(let r=0; r&lt;Math.min(rows.length,25); r++) {
    const row = rows[r];
    for(let c=0; c&lt;row.length; c++) {
      const v = (row[c]||&quot;&quot;).toString().trim();
      if (v===&quot;Ø§Ù„Ø­Ø§Ù„Ø©&quot; || v===&quot;Status&quot;) colStatus=c;
      if (v.includes(&quot;Ø§Ù„ØºØ±ÙØ©&quot;) || v.includes(&quot;Room&quot;)) colRoom=c;
      if (v.includes(&quot;ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬&quot;) || v.includes(&quot;Departure&quot;)) colOut=c;
    }
    if(colStatus!==-1 &amp;&amp; colRoom!==-1) { headerRow=r; break; }
  }
  
  const stats = {};
  CANONICAL_TYPES.forEach(t =&gt; stats[t] = { vac:0, vacList:[], dep:0, depList:[] }); 
  if(headerRow===-1) throw new Error(&quot;Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¹Ù…Ø¯Ø© (Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø§Ù„ØºØ±ÙØ©) ÙÙŠ Ù…Ù„Ù Ù†Ø²ÙŠÙ„.&quot;);

  for(let r=headerRow+1; r&lt;rows.length; r++) {
    const row = rows[r];
    const status = (row[colStatus]||&quot;&quot;).toString().trim();
    const room = (row[colRoom]||&quot;&quot;).toString().trim();
    const outDate = row[colOut];

    if(!room || room.includes(&quot;104&quot;) || (room.includes(&quot;Ø°ÙˆÙŠ&quot;) &amp;&amp; room.includes(&quot;Ø¹Ø§Ù‚Ø©&quot;))) continue;
    const type = mapUnit(room);
    if(!type) continue;

    if([&quot;ÙØ§Ø±ØºØ©&quot;, &quot;ØªÙ†Ø¸ÙŠÙ&quot;, &quot;Vacant&quot;, &quot;Dirty&quot;].includes(status)) {
      stats[type].vac++;
      stats[type].vacList.push(`&lt;span class=&quot;guest-item&quot;&gt;${room} (${status})&lt;/span&gt;`);
    }

    let isToday = false;
    if(status.includes(&quot;Ù…ØºØ§Ø¯Ø±Ø©&quot;) || status.includes(&quot;Departure&quot;)) isToday = true; 
    else if(outDate &amp;&amp; (outDate.toString().includes(todayStr) || outDate.toString().includes(new Date().toLocaleDateString(&#x27;en-GB&#x27;)))) {
       isToday = true;
    }

    if((status===&quot;Ù…Ø¤Ø¬Ø±Ø©&quot; || status===&quot;Occupied&quot;) &amp;&amp; isToday) {
      stats[type].dep++;
      stats[type].depList.push(`&lt;span class=&quot;guest-item&quot;&gt;${room}&lt;/span&gt;`);
    }
  }
  return stats;
}

function runAudit() {
  const errDiv = document.getElementById(&quot;errorArea&quot;);
  errDiv.style.display = &quot;none&quot;;
  errDiv.textContent = &quot;&quot;;
  
  const fB = document.getElementById(&quot;fileBooking&quot;).files[0];
  const fN = document.getElementById(&quot;fileNazeel&quot;).files[0];
  
  if(!fB || !fN) { 
    errDiv.textContent = &quot;âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙÙŠ ÙˆØ¶Ø¹ &#x27;Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª&#x27;&quot;; 
    errDiv.style.display = &quot;block&quot;;
    return; 
  }

  const rB = new FileReader();
  rB.onload = e =&gt; {
    try {
      const wb = XLSX.read(e.target.result, {type:&#x27;array&#x27;});
      const rawRows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1});
      const statsB = processBooking(rawRows);
      
      const rN = new FileReader();
      rN.onload = e2 =&gt; {
        try {
          const wb2 = XLSX.read(e2.target.result, {type:&#x27;array&#x27;});
          const rawRowsN = XLSX.utils.sheet_to_json(wb2.Sheets[wb2.SheetNames[0]], {header:1});
          const statsN = processNazeel(rawRowsN);
          
          window.nazeelLastRunData = statsN;
          window.bookingLastRunData = statsB;

          draw(statsB, statsN);
        } catch(x) { 
          errDiv.textContent = &quot;Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù Ù†Ø²ÙŠÙ„: &quot; + x.message; 
          errDiv.style.display = &quot;block&quot;;
        }
      };
      rN.readAsArrayBuffer(fN);
    } catch(x) { 
      errDiv.innerHTML = &quot;Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù Ø¨ÙˆÙƒÙŠÙ†Ø¬:&lt;br&gt;&quot; + x.message; 
      errDiv.style.display = &quot;block&quot;;
    }
  };
  rB.readAsArrayBuffer(fB);
}

document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; {
    initializeFixedInputTables(); 
    switchMode(&#x27;upload&#x27;); 

    const savedTheme = localStorage.getItem(THEME_KEY) || &#x27;light&#x27;;
    applyTheme(savedTheme);

    const toggleBtn = document.getElementById(&#x27;themeToggle&#x27;);
    if (toggleBtn) {
      toggleBtn.addEventListener(&#x27;click&#x27;, () =&gt; {
        const isDark = document.body.classList.contains(&#x27;theme-dark&#x27;);
        const newTheme = isDark ? &#x27;light&#x27; : &#x27;dark&#x27;;
        applyTheme(newTheme);
        localStorage.setItem(THEME_KEY, newTheme);
      });
    }
});
&lt;/script&gt;

&lt;div class=&quot;sign-off fixed-bottom&quot;&gt;
  &lt;span class=&quot;sign-off-item&quot;&gt;ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-name&quot;&gt;| &lt;b&gt;Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&lt;/b&gt;&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-email&quot;&gt;| 77aayy@gmail.com&lt;/span&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;"></iframe>
  <iframe id="frameBooking" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ar&quot; dir=&quot;rtl&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Elite Price System â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&lt;/title&gt;
&lt;link href=&quot;https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;

&lt;style&gt;
/* ------------------------- Ø­Ø±ÙƒØ§Øª ------------------------- */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* ------------------------- Dark UI Ù…Ø«Ù„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª ------------------------- */
body {
    font-family: &#x27;Tajawal&#x27;, sans-serif;
    background: #0f172a;      /* ÙƒØ­Ù„ÙŠ Ø¯Ø§ÙƒÙ† */
    color: #f1f5f9;           /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
    margin: 0;
    text-align: center;
    padding: 30px 10px;
}

/* ------------------------- ØµÙ†Ø¯ÙˆÙ‚ ÙØ±Ø¹ ------------------------- */
.branch {
    width: 95%;
    max-width: 1100px;
    margin: 25px auto;
    background: #1e293b;  /* Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø¯Ø§ÙƒÙ† */
    padding: 22px;
    border-radius: 16px;
    border: 1px solid #334155;
    box-shadow: 0 12px 28px rgba(0,0,0,0.35);
    opacity: 0;
}
.branch h2 {
    text-align: right;
    color: #93c5fd;
    font-size: 22px;
    font-weight: 700;
    border-bottom: 1px solid #334155;
    padding-bottom: 10px;
}

/* ------------------------- Ø¬Ø¯ÙˆÙ„ ------------------------- */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    padding: 12px 8px;
    border-bottom: 1px solid #334155;
}
th {
    background: #0f172a;
    color: #93c5fd;
    font-size: 15px;
}

/* ------------------------- Ø²Ø±Ø§Ø± ------------------------- */
.btn {
    background: #2563eb;
    border: none;
    padding: 10px 22px;
    font-size: 15px;
    border-radius: 8px;
    cursor: pointer;
    color: #fff;
    margin-top: 15px;
}
.btn:hover {
    background: #1d4ed8;
}

/* ------------------------- Ù†Ù…Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ù†ÙØ³ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª) ------------------------- */
input[type=number] {
    width: 110px;
    padding: 6px 4px;
    border-radius: 10px;
    background: #0f172a;
    border: 1px solid #334155;
    color: #e2e8f0;
    font-size: 20px;
    font-weight: 600;
    text-align: center;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco;
    box-shadow: 0 1px 2px rgba(0,0,0,0.25);
    transition: 0.15s;
}

/* ------------------------- Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ------------------------- */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type=number] {
    -moz-appearance: textfield;
}

/* ------------------------- ÙÙˆÙƒØ³ ------------------------- */
input[type=number]:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 2px rgba(96,165,250,0.25);
    outline: none;
}

/* ------------------------- Ø³Ø¹Ø± Ø¨ÙˆÙƒÙŠÙ†Ø¬ ------------------------- */
.booking {
    background: #1e3a8a;
    border-color: #3b82f6;
    color: #bae6fd;
}

/* ------------------------- Ù†Ø³Ø¨Ø© ------------------------- */
.rate-input {
    width: 75px;
}

/* ------------------------- Unified ------------------------- */
.unify {
    margin: 5px 0 15px;
    background: #0f172a;
    padding: 10px;
    border-radius: 10px;
    border: 1px dashed #334155;
    display: inline-flex;
    gap: 10px;
    align-items: center;
    color: #cbd5e1;
}

.footer {
    margin-top: 25px;
    color: #64748b;
}
&lt;/style&gt;
&lt;/head&gt;



&lt;body&gt;

&lt;h1 style=&quot;color:#93c5fd; font-size:26px; margin-bottom:25px;&quot;&gt;Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ â€“ Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&lt;/h1&gt;

&lt;!-- ===================== ÙØ±Ø¹ Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´ ===================== --&gt;
&lt;div class=&quot;branch&quot; id=&quot;corniche&quot;&gt;
    &lt;h2&gt;ğŸ¨ ÙØ±Ø¹ Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´&lt;/h2&gt;

    &lt;div class=&quot;unify&quot;&gt;
        &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;unifyC&quot; onchange=&quot;setUnify(&#x27;c&#x27;)&quot;&gt; ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©&lt;/label&gt;
        &lt;input type=&quot;number&quot; id=&quot;rateC&quot; value=&quot;45&quot; onchange=&quot;setUnify(&#x27;c&#x27;)&quot;&gt; %
    &lt;/div&gt;

    &lt;table&gt;
        &lt;tr&gt;&lt;th&gt;Ø§Ù„ÙˆØ­Ø¯Ø©&lt;/th&gt;&lt;th&gt;Ø§Ù„Ø³Ø¹Ø±&lt;/th&gt;&lt;th&gt;Ø§Ù„Ø²ÙŠØ§Ø¯Ø© %&lt;/th&gt;&lt;th&gt;Ø¨ÙˆÙƒÙŠÙ†Ø¬&lt;/th&gt;&lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØªØ¤Ù… ÙˆÙƒÙŠÙ†Ø¬&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_p1&quot; value=&quot;230&quot; oninput=&quot;calc(&#x27;c&#x27;,1)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_r1&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;c&#x27;,1)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_b1&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;Ø³ØªÙˆØ¯ÙŠÙˆ&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_p2&quot; value=&quot;340&quot; oninput=&quot;calc(&#x27;c&#x27;,2)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_r2&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;c&#x27;,2)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_b2&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;Ø´Ù‚Ø© ØºØ±ÙØ© ÙˆØµØ§Ù„Ø©&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_p3&quot; value=&quot;370&quot; oninput=&quot;calc(&#x27;c&#x27;,3)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_r3&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;c&#x27;,3)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_b3&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØªÙŠÙ† ÙˆØµØ§Ù„Ø©&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_p4&quot; value=&quot;400&quot; oninput=&quot;calc(&#x27;c&#x27;,4)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_r4&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;c&#x27;,4)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_b4&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;VIP&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_p5&quot; value=&quot;850&quot; oninput=&quot;calc(&#x27;c&#x27;,5)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_r5&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;c&#x27;,5)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;c_b5&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;

    &lt;button class=&quot;btn&quot; onclick=&quot;downloadExcel(&#x27;c&#x27;)&quot;&gt;ØªØ­Ù…ÙŠÙ„ Excel&lt;/button&gt;
&lt;/div&gt;




&lt;!-- ===================== ÙØ±Ø¹ Ø§Ù„Ø£Ù†Ø¯Ù„Ø³ ===================== --&gt;
&lt;div class=&quot;branch&quot; id=&quot;andalus&quot;&gt;
    &lt;h2&gt;ğŸ¨ ÙØ±Ø¹ Ø§Ù„Ø£Ù†Ø¯Ù„Ø³&lt;/h2&gt;

    &lt;div class=&quot;unify&quot;&gt;
        &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;unifyA&quot; onchange=&quot;setUnify(&#x27;a&#x27;)&quot;&gt; ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©&lt;/label&gt;
        &lt;input type=&quot;number&quot; id=&quot;rateA&quot; value=&quot;45&quot; onchange=&quot;setUnify(&#x27;a&#x27;)&quot;&gt; %
    &lt;/div&gt;

    &lt;table&gt;
        &lt;tr&gt;&lt;th&gt;Ø§Ù„ÙˆØ­Ø¯Ø©&lt;/th&gt;&lt;th&gt;Ø§Ù„Ø³Ø¹Ø±&lt;/th&gt;&lt;th&gt;Ø§Ù„Ø²ÙŠØ§Ø¯Ø© %&lt;/th&gt;&lt;th&gt;Ø¨ÙˆÙƒÙŠÙ†Ø¬&lt;/th&gt;&lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØ© Ø®Ù„ÙÙŠØ© ØªØ¤Ù…&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p1&quot; value=&quot;190&quot; oninput=&quot;calc(&#x27;a&#x27;,1)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r1&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,1)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b1&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØ© Ø®Ù„ÙÙŠØ© ÙƒÙŠÙ†Ø¬&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p2&quot; value=&quot;205&quot; oninput=&quot;calc(&#x27;a&#x27;,2)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r2&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,2)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b2&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;Ø³ØªÙˆØ¯ÙŠÙˆ Ø´Ø§Ø±Ø¹&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p3&quot; value=&quot;220&quot; oninput=&quot;calc(&#x27;a&#x27;,3)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r3&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,3)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b3&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØ© ÙˆØµØ§Ù„Ø© Ø´Ø§Ø±Ø¹&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p4&quot; value=&quot;290&quot; oninput=&quot;calc(&#x27;a&#x27;,4)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r4&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,4)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b4&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØªÙŠÙ† Ø®Ù„ÙÙŠ&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p5&quot; value=&quot;390&quot; oninput=&quot;calc(&#x27;a&#x27;,5)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r5&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,5)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b5&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;ØºØ±ÙØªÙŠÙ† ÙˆØµØ§Ù„Ø© Ø´Ø§Ø±Ø¹&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p6&quot; value=&quot;420&quot; oninput=&quot;calc(&#x27;a&#x27;,6)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r6&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,6)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b6&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;VIP 601&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p7&quot; value=&quot;570&quot; oninput=&quot;calc(&#x27;a&#x27;,7)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r7&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,7)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b7&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;VIP 602&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p8&quot; value=&quot;370&quot; oninput=&quot;calc(&#x27;a&#x27;,8)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r8&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,8)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b8&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;&lt;td&gt;VIP 604&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_p9&quot; value=&quot;320&quot; oninput=&quot;calc(&#x27;a&#x27;,9)&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_r9&quot; value=&quot;45&quot; oninput=&quot;calc(&#x27;a&#x27;,9)&quot; class=&quot;rate-input&quot;&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;number&quot; id=&quot;a_b9&quot; class=&quot;booking&quot; readonly&gt;&lt;/td&gt;
        &lt;/tr&gt;

    &lt;/table&gt;

    &lt;button class=&quot;btn&quot; onclick=&quot;downloadExcel(&#x27;a&#x27;)&quot;&gt;ØªØ­Ù…ÙŠÙ„ Excel&lt;/button&gt;
&lt;/div&gt;


&lt;div class=&quot;footer&quot; id=&quot;footer&quot;&gt;Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:&lt;/div&gt;

&lt;!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥ÙƒØ³Ù„ --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
/* ------------------------ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø®Ø§Ù†Ø§Øª ------------------------ */
function clearOnFocus(event) {
    const input = event.target;
    if (input.readOnly) return;
    input.dataset.oldValue = input.value;
    input.value = &quot;&quot;;
}
function restoreOnBlur(event) {
    const input = event.target;
    if (!input.readOnly &amp;&amp; input.value.trim()===&quot;&quot;) {
        input.value = input.dataset.oldValue || &quot;&quot;;
    }
}
function enhanceInputs() {
    document.querySelectorAll(&quot;input[type=&#x27;number&#x27;]&quot;).forEach(inp=&gt;{
        if (!inp.readOnly){
            inp.addEventListener(&quot;focus&quot;,clearOnFocus);
            inp.addEventListener(&quot;blur&quot;,restoreOnBlur);
        }
    });
}

/* ------------------------ Ø§Ù„Ø­Ø³Ø§Ø¨ ------------------------ */
function calc(branch,i){
    let p=parseFloat(document.getElementById(branch+&#x27;_p&#x27;+i).value)||0;
    let r=parseFloat(document.getElementById(branch+&#x27;_r&#x27;+i).value)||0;
    document.getElementById(branch+&#x27;_b&#x27;+i).value=(p*(1+r/100)).toFixed(2);
}

/* ------------------------ ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø© ------------------------ */
function setUnify(branch){
    let unify=document.getElementById(branch===&#x27;c&#x27;?&#x27;unifyC&#x27;:&#x27;unifyA&#x27;).checked;
    let rate=parseFloat(document.getElementById(branch===&#x27;c&#x27;?&#x27;rateC&#x27;:&#x27;rateA&#x27;).value)||0;
    let rows=branch===&#x27;c&#x27;?5:9;
    for(let i=1;i&lt;=rows;i++){
        document.getElementById(branch+&#x27;_r&#x27;+i).value = unify?rate:45;
        calc(branch,i);
    }
}

/* ------------------------ Ø§Ù„ØªØ§Ø±ÙŠØ® ------------------------ */
function arabicDate(d){
    const m=[&#x27;ÙŠÙ†Ø§ÙŠØ±&#x27;,&#x27;ÙØ¨Ø±Ø§ÙŠØ±&#x27;,&#x27;Ù…Ø§Ø±Ø³&#x27;,&#x27;Ø£Ø¨Ø±ÙŠÙ„&#x27;,&#x27;Ù…Ø§ÙŠÙˆ&#x27;,&#x27;ÙŠÙˆÙ†ÙŠÙˆ&#x27;,&#x27;ÙŠÙˆÙ„ÙŠÙˆ&#x27;,&#x27;Ø£ØºØ³Ø·Ø³&#x27;,&#x27;Ø³Ø¨ØªÙ…Ø¨Ø±&#x27;,&#x27;Ø£ÙƒØªÙˆØ¨Ø±&#x27;,&#x27;Ù†ÙˆÙÙ…Ø¨Ø±&#x27;,&#x27;Ø¯ÙŠØ³Ù…Ø¨Ø±&#x27;];
    return d.getDate()+&quot; &quot;+m[d.getMonth()]+&quot; &quot;+d.getFullYear();
}

/* ------------------------ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ------------------------ */
function applyBranchAnimation() {
    document.querySelectorAll(&#x27;.branch&#x27;).forEach((b,i)=&gt;{
        setTimeout(()=&gt;{
            b.style.opacity=1;
            b.style.animation=&quot;fadeInUp .8s ease-out&quot;;
        }, i*180);
    });
}

/* ------------------------ ØªØµØ¯ÙŠØ± Ø¥ÙƒØ³Ù„ ------------------------ */
function downloadExcel(branch){
    const wb=XLSX.utils.book_new();

    const title=&quot;Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ â€“ Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&quot;;
    const branchName = branch===&#x27;c&#x27;?&#x27;ÙØ±Ø¹ Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´&#x27;:&#x27;ÙØ±Ø¹ Ø§Ù„Ø£Ù†Ø¯Ù„Ø³&#x27;;
    const now=new Date();
    const dateText=&quot;ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: &quot;+arabicDate(now);
    const timeText=&quot;ÙˆÙ‚Øª Ø§Ù„ØªØµØ¯ÙŠØ±: &quot;+now.toLocaleTimeString(&#x27;en-GB&#x27;);
    const rows = branch===&#x27;c&#x27;?5:9;

    let data=[
        [title],[branchName],[],
        [&quot;Ø§Ù„ÙˆØ­Ø¯Ø©&quot;,&quot;Ø§Ù„Ø³Ø¹Ø±&quot;,&quot;Ø¨ÙˆÙƒÙŠÙ†Ø¬&quot;]
    ];

    for(let i=1;i&lt;=rows;i++){
        data.push([
            document.querySelector(`#${branch===&#x27;c&#x27;?&#x27;corniche&#x27;:&#x27;andalus&#x27;} table tr:nth-child(${i+1}) td:first-child`).innerText,
            document.getElementById(branch+&#x27;_p&#x27;+i).value,
            document.getElementById(branch+&#x27;_b&#x27;+i).value
        ]);
    }

    data.push([],[dateText],[timeText]);

    const ws=XLSX.utils.aoa_to_sheet(data);
    ws[&#x27;!cols&#x27;]=[{wch:35},{wch:15},{wch:15}];

    XLSX.utils.book_append_sheet(wb,ws,&quot;Sheet&quot;);
    XLSX.writeFile(wb, branch===&#x27;c&#x27;?&#x27;Corniche.xlsx&#x27;:&#x27;Andalus.xlsx&#x27;);
}

/* ------------------------ ØªÙ‡ÙŠØ¦Ø© ------------------------ */
function init(){
    document.getElementById(&#x27;footer&#x27;).innerText+=&quot; &quot;+arabicDate(new Date());
    for(let i=1;i&lt;=5;i++) calc(&#x27;c&#x27;,i);
    for(let i=1;i&lt;=9;i++) calc(&#x27;a&#x27;,i);
    enhanceInputs();
    applyBranchAnimation();
}

window.onload = init;
&lt;/script&gt;


&lt;div class=&quot;sign-off fixed-bottom&quot;&gt;
  &lt;span class=&quot;sign-off-item&quot;&gt;ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-name&quot;&gt;| &lt;b&gt;Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡&lt;/b&gt;&lt;/span&gt;
  &lt;span class=&quot;sign-off-item sign-off-email&quot;&gt;| 77aayy@gmail.com&lt;/span&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
" style="display:none"></iframe>
  <div id="frameSeasons" style="display:none;">
    <div class="seasons-shell">
      <div class="seasons-title">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø³Ù… ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</div>
      <div class="seasons-sub">
        Ø§Ù„ÙØªØ±Ø© Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø¹Ø§Ù… 1446â€“1447 Ù‡Ù€ Ø­ØªÙ‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 1448â€“1449 Ù‡Ù€<br/>
        (Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)
      </div>
      <table class="seasons-table">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
            <th>Ø§Ù„Ø­Ø¯Ø«</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</th>
          </tr>
        </thead>
        <tbody id="seasonsBody"></tbody>
      </table>
      <div class="seasons-footer-note">
        Ù…ØµØ¯Ø± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ + ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (saudicalendars.com)ØŒ
        Ù…Ø¹ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ ÙƒÙ…ØµØ¯Ø± Ø£Ø³Ø§Ø³ÙŠ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§Ø±Ø¶.
      </div>
    </div>
  </div>
</div>

<div class="sign-off fixed-bottom">
  <span class="sign-off-item">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©</span>
  <span class="sign-off-item sign-off-name">| <b>Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡</b></span>
  <span class="sign-off-item sign-off-email">| 77aayy@gmail.com</span>
</div>

</body>
</html>
