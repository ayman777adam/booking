<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ â€“ VPRO Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
/* === VPRO Darker Theme === */
:root {
  --bg-body: #F0F2F5;       
  --bg-card: #FFFFFF;
  --primary-dark: #2B3674;  
  --accent-gold: #D4AF37;
  --text-main: #2B3674;
  --text-sub: #8F9BBA;
  --shadow: 0px 4px 20px rgba(43, 54, 116, 0.05);
  --radius: 20px;
  --border-color: #E0E5F2; /* Ù„ÙˆÙ† ÙÙˆØ§ØµÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Tajawal", "Cairo", sans-serif;
  background: var(--bg-body);
  color: var(--text-main);
  padding-bottom: 60px;
}

/* Navigation */
#switchBar {
  display: flex;
  justify-content: center;
  padding: 15px;
  background: var(--primary-dark);
  position: sticky;
  top: 0;
  z-index: 9999;
  box-shadow: 0 4px 15px rgba(43, 54, 116, 0.2);
}

.nav-container {
  display: flex;
  gap: 10px;
  background: rgba(255, 255, 255, 0.1);
  padding: 5px;
  border-radius: 50px;
}

.switchBtn {
  padding: 10px 25px;
  border-radius: 40px;
  border: none;
  background: transparent;
  color: #E9EDF7;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.switchBtn.active {
  background: var(--bg-card);
  color: var(--primary-dark);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.frame-wrapper {
  width: 95%;
  max-width: 1200px;
  margin: 20px auto;
  min-height: 80vh;
}

.section-view { display: none; animation: fadeIn 0.4s ease-out; }
.section-view.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Card Style */
.card {
  background: var(--bg-card);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
  margin-bottom: 25px;
  border: 1px solid #fff;
}

h1, h2 { color: var(--primary-dark); margin-top: 0; }
.subtitle { color: var(--text-sub); font-size: 0.9rem; margin-bottom: 20px; }

/* Upload Inputs */
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.upload-box {
  border: 2px dashed #D1D9E6; border-radius: var(--radius); padding: 25px;
  text-align: center; background: #F8F9FC; transition: 0.3s;
}
.upload-box:hover { border-color: var(--accent-gold); background: #FFFDF5; }
input[type="file"] { width: 100%; }

/* Action Buttons */
.btn-action {
  background: var(--primary-dark); color: #fff; border: none; padding: 15px 40px;
  border-radius: 50px; font-size: 16px; font-weight: 700; cursor: pointer; width: 100%;
  box-shadow: 0 5px 15px rgba(43, 54, 116, 0.2); transition: 0.2s;
}
.btn-action:hover { transform: translateY(-2px); background: #1F2855; }

.btn-download {
    background: #fff; border: 1px solid var(--primary-dark); color: var(--primary-dark);
    padding: 10px 25px; border-radius: 20px; cursor: pointer; font-weight: 600; margin-top: 15px;
    transition: 0.2s;
}
.btn-download:hover { background: var(--primary-dark); color: #fff; }

/* === Tables (High Contrast & Clear Divisions) === */
table { 
    width: 100%; 
    border-collapse: separate; /* Ù„Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© */
    border-spacing: 0; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ø·ÙˆØ· */
    margin-top: 15px; 
    border: 1px solid var(--border-color);
    border-radius: 15px;
    overflow: hidden;
}

th { 
    background: #F4F7FE;
    color: var(--primary-dark); 
    font-weight: 700; 
    padding: 15px; 
    font-size: 0.9rem; 
    border-bottom: 2px solid #D1D9E6;
}

td { 
    padding: 15px; 
    text-align: center; 
    font-weight: 600; 
    color: var(--primary-dark); 
    border-bottom: 1px solid var(--border-color); /* Ø®Ø· ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ */
}

/* Zebra Striping (ØªØ®Ø·ÙŠØ· Ø§Ù„Ø­Ù…Ø§Ø± Ø§Ù„ÙˆØ­Ø´ÙŠ) */
tbody tr:nth-child(even) {
    background-color: #FAFBFF; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© */
}
tbody tr:hover {
    background-color: #F0F4FF; /* Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ */
}

tr:last-child td { border-bottom: none; }

/* Inputs inside tables */
.calc-input {
    width: 90px; text-align: center; border: 1px solid #D1D9E6; 
    border-radius: 8px; padding: 8px; font-weight: 700; color: var(--primary-dark);
    background: #fff; font-size: 1rem;
    transition: 0.2s;
}
.calc-input:focus { 
    border-color: var(--accent-gold); 
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    outline: none; 
}
.calc-readonly { background: #E9EDF7; border: none; color: var(--primary-dark); pointer-events: none; }
.rate-input { width: 60px; }

/* Badges */
.badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; display: inline-block; white-space: nowrap; }
.badge-ok { background: rgba(5, 205, 153, 0.15); color: #05CD99; }
.badge-err { background: rgba(238, 93, 80, 0.15); color: #EE5D50; }
.badge-warn { background: rgba(255, 181, 71, 0.15); color: #FFB547; }
.badge-gold { background: rgba(212, 175, 55, 0.15); color: #D4AF37; }
.badge-season { background: rgba(5, 205, 153, 0.1); color: #05CD99; border: 1px solid rgba(5, 205, 153, 0.2); }
.badge-rukood { background: #eee; color: #888; border: 1px solid #ddd; }

/* === Next Season Highlight Effect === */
.highlight-next-season {
    border: 2px solid var(--accent-gold) !important;
    background: #FFFDF5 !important;
    position: relative;
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    animation: pulse-gold 2s infinite;
    z-index: 1;
}
.highlight-next-season td {
    border-top: 1px solid var(--accent-gold);
    border-bottom: 1px solid var(--accent-gold);
    color: #9A7D0A; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ø¯Ø§ÙƒÙ† Ù„Ù„Ù†Øµ */
}
.highlight-next-season td:first-child { border-left: 2px solid var(--accent-gold); }
.highlight-next-season td:last-child { border-right: 2px solid var(--accent-gold); }

@keyframes pulse-gold {
    0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
    100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
}

/* Sign-off */
.sign-off {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--bg-card); padding: 10px; text-align: center;
  font-size: 0.8rem; color: var(--text-sub); border-top: 1px solid #eee; z-index: 999;
}
.sign-off b { color: var(--primary-dark); }
.sign-off-email { color: var(--accent-gold); font-family: monospace; }

#errorArea {
  background: #FFF2F2; color: #EE5D50; padding: 15px; border-radius: 15px; 
  margin-bottom: 20px; display: none; border: 1px solid #FFD6D6;
}

/* === PRINT STYLES (A4 Landscape) === */
@media print {
    @page { size: A4 landscape; margin: 10mm; }
    body { background: #fff; padding: 0; margin: 0; }
    
    /* Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ */
    #switchBar, .upload-grid, #errorArea, .btn-action, .btn-download, 
    h1, .subtitle, h2, 
    .card { 
        display: none !important; 
        box-shadow: none !important; 
        border: none !important; 
        margin: 0 !important; padding: 0 !important;
    }

    /* Ø¥Ø¸Ù‡Ø§Ø± ÙÙ‚Ø· Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹ */
    #output { display: block !important; }
    /* Ù†Ø®ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø¨ÙˆÙƒÙŠÙ†Ø¬ ÙˆÙ†Ø²ÙŠÙ„ØŒ ÙˆÙ†Ø¸Ù‡Ø± ÙÙ‚Ø· Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© */
    #output .card:nth-child(1), #output .card:nth-child(2) { display: none !important; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    #output .card:nth-child(3) {
        display: block !important;
        position: absolute; top: 0; left: 0; width: 100%;
    }
    
    /* Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    #output .card:nth-child(3) h2 { 
        display: block !important; 
        text-align: center; 
        font-size: 24px; 
        margin-bottom: 20px !important;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
    }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    table { border: 1px solid #000 !important; width: 100%; }
    th { background: #eee !important; color: #000 !important; border: 1px solid #000; }
    td { border: 1px solid #000 !important; color: #000 !important; }
    
    /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    .sign-off { 
        display: block !important; position: fixed; bottom: 0; 
        border: none; color: #000; font-size: 10px;
    }
}
</style>
</head>
<body>

<div id="switchBar">
  <div class="nav-container">
    <button class="switchBtn active" onclick="switchTab('compare')">ğŸ” Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</button>
    <button class="switchBtn" onclick="switchTab('booking')">ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
    <button class="switchBtn" onclick="switchTab('seasons')">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø³Ù…</button>
  </div>
</div>

<div class="frame-wrapper">

  <div id="view-compare" class="section-view active">
    <div class="card">
      <h1>Ø§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø´ÙØ§Ù</h1>
      <div class="subtitle">Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚ (Booking & Nazeel)</div>
      
      <div id="errorArea"></div>

      <div class="upload-grid">
        <div class="upload-box">
          <label style="display:block;margin-bottom:10px;color:var(--primary-dark);font-weight:bold">Ù…Ù„Ù Booking</label>
          <input type="file" id="fileBooking" accept=".xlsx,.xls,.csv">
        </div>
        <div class="upload-box">
          <label style="display:block;margin-bottom:10px;color:var(--primary-dark);font-weight:bold">Ù…Ù„Ù Nazeel</label>
          <input type="file" id="fileNazeel" accept=".xlsx,.xls,.csv">
        </div>
      </div>

      <button class="btn-action" onclick="runAudit()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
    </div>

    <div id="output" style="display:none;">
      <div class="card">
        <h2>1. ØªØ­Ù„ÙŠÙ„ Booking</h2>
        <div id="tableBooking"></div>
      </div>
      <div class="card">
        <h2>2. ØªØ­Ù„ÙŠÙ„ Nazeel</h2>
        <div id="tableNazeel"></div>
      </div>
      <div class="card" id="comparisonCard">
        <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ÙˆØ§Ù„ØªÙˆØµÙŠØ©)</h2>
        <div id="tableCompare"></div>
        <div style="text-align:center; margin-top:20px;">
           <button class="btn-download" onclick="exportComparisonToExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
           <button class="btn-download" onclick="window.print()" style="background:var(--primary-dark); color:#fff; border:none;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± (A4)</button>
        </div>
      </div>
    </div>
  </div>

  <div id="view-booking" class="section-view">
    <div class="card">
      <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h1>
      
      <div id="corniche" style="margin-bottom:40px; border-bottom:2px solid #f0f0f0; padding-bottom:30px;">
        <h2 style="color:var(--accent-gold)">ğŸ¨ ÙØ±Ø¹ Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´</h2>
        <div style="margin-bottom:15px;">
            <label style="cursor:pointer; font-weight:bold; margin-left:15px;">
                <input type="checkbox" id="unifyC" onchange="setUnify('c')"> ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©
            </label>
            <input type="number" id="rateC" value="45" onchange="setUnify('c')" class="calc-input rate-input"> %
        </div>

        <table>
            <thead><tr><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th><th>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© %</th><th>Ø³Ø¹Ø± Ø¨ÙˆÙƒÙŠÙ†Ø¬</th></tr></thead>
            <tbody>
                <tr><td>ØªØ¤Ù… ÙˆÙƒÙŠÙ†Ø¬</td>
                    <td><input type="number" id="c_p1" value="230" oninput="calc('c',1)" class="calc-input"></td>
                    <td><input type="number" id="c_r1" value="45" oninput="calc('c',1)" class="calc-input rate-input"></td>
                    <td><input type="number" id="c_b1" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>Ø³ØªÙˆØ¯ÙŠÙˆ</td>
                    <td><input type="number" id="c_p2" value="340" oninput="calc('c',2)" class="calc-input"></td>
                    <td><input type="number" id="c_r2" value="45" oninput="calc('c',2)" class="calc-input rate-input"></td>
                    <td><input type="number" id="c_b2" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>Ø´Ù‚Ø© ØºØ±ÙØ© ÙˆØµØ§Ù„Ø©</td>
                    <td><input type="number" id="c_p3" value="370" oninput="calc('c',3)" class="calc-input"></td>
                    <td><input type="number" id="c_r3" value="45" oninput="calc('c',3)" class="calc-input rate-input"></td>
                    <td><input type="number" id="c_b3" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>ØºØ±ÙØªÙŠÙ† ÙˆØµØ§Ù„Ø©</td>
                    <td><input type="number" id="c_p4" value="400" oninput="calc('c',4)" class="calc-input"></td>
                    <td><input type="number" id="c_r4" value="45" oninput="calc('c',4)" class="calc-input rate-input"></td>
                    <td><input type="number" id="c_b4" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>VIP</td>
                    <td><input type="number" id="c_p5" value="850" oninput="calc('c',5)" class="calc-input"></td>
                    <td><input type="number" id="c_r5" value="45" oninput="calc('c',5)" class="calc-input rate-input"></td>
                    <td><input type="number" id="c_b5" class="calc-input calc-readonly" readonly></td>
                </tr>
            </tbody>
        </table>
        <button class="btn-download" onclick="downloadExcel('c')">ØªØ­Ù…ÙŠÙ„ Excel (Ø§Ù„ÙƒÙˆØ±Ù†ÙŠØ´)</button>
      </div>

      <div id="andalus">
        <h2 style="color:var(--accent-gold)">ğŸ¨ ÙØ±Ø¹ Ø§Ù„Ø£Ù†Ø¯Ù„Ø³</h2>
        <div style="margin-bottom:15px;">
            <label style="cursor:pointer; font-weight:bold; margin-left:15px;">
                <input type="checkbox" id="unifyA" onchange="setUnify('a')"> ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù†Ø³Ø¨Ø©
            </label>
            <input type="number" id="rateA" value="45" onchange="setUnify('a')" class="calc-input rate-input"> %
        </div>

        <table>
            <thead><tr><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th><th>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© %</th><th>Ø³Ø¹Ø± Ø¨ÙˆÙƒÙŠÙ†Ø¬</th></tr></thead>
            <tbody>
                <tr><td>ØºØ±ÙØ© Ø®Ù„ÙÙŠØ© ØªØ¤Ù…</td>
                    <td><input type="number" id="a_p1" value="190" oninput="calc('a',1)" class="calc-input"></td>
                    <td><input type="number" id="a_r1" value="45" oninput="calc('a',1)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b1" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>ØºØ±ÙØ© Ø®Ù„ÙÙŠØ© ÙƒÙŠÙ†Ø¬</td>
                    <td><input type="number" id="a_p2" value="205" oninput="calc('a',2)" class="calc-input"></td>
                    <td><input type="number" id="a_r2" value="45" oninput="calc('a',2)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b2" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>Ø³ØªÙˆØ¯ÙŠÙˆ Ø´Ø§Ø±Ø¹</td>
                    <td><input type="number" id="a_p3" value="220" oninput="calc('a',3)" class="calc-input"></td>
                    <td><input type="number" id="a_r3" value="45" oninput="calc('a',3)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b3" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>ØºØ±ÙØ© ÙˆØµØ§Ù„Ø© Ø´Ø§Ø±Ø¹</td>
                    <td><input type="number" id="a_p4" value="290" oninput="calc('a',4)" class="calc-input"></td>
                    <td><input type="number" id="a_r4" value="45" oninput="calc('a',4)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b4" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>ØºØ±ÙØªÙŠÙ† Ø®Ù„ÙÙŠ</td>
                    <td><input type="number" id="a_p5" value="390" oninput="calc('a',5)" class="calc-input"></td>
                    <td><input type="number" id="a_r5" value="45" oninput="calc('a',5)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b5" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>ØºØ±ÙØªÙŠÙ† ÙˆØµØ§Ù„Ø© Ø´Ø§Ø±Ø¹</td>
                    <td><input type="number" id="a_p6" value="420" oninput="calc('a',6)" class="calc-input"></td>
                    <td><input type="number" id="a_r6" value="45" oninput="calc('a',6)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b6" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>VIP 601</td>
                    <td><input type="number" id="a_p7" value="570" oninput="calc('a',7)" class="calc-input"></td>
                    <td><input type="number" id="a_r7" value="45" oninput="calc('a',7)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b7" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>VIP 602</td>
                    <td><input type="number" id="a_p8" value="370" oninput="calc('a',8)" class="calc-input"></td>
                    <td><input type="number" id="a_r8" value="45" oninput="calc('a',8)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b8" class="calc-input calc-readonly" readonly></td>
                </tr>
                <tr><td>VIP 604</td>
                    <td><input type="number" id="a_p9" value="320" oninput="calc('a',9)" class="calc-input"></td>
                    <td><input type="number" id="a_r9" value="45" oninput="calc('a',9)" class="calc-input rate-input"></td>
                    <td><input type="number" id="a_b9" class="calc-input calc-readonly" readonly></td>
                </tr>
            </tbody>
        </table>
        <button class="btn-download" onclick="downloadExcel('a')">ØªØ­Ù…ÙŠÙ„ Excel (Ø§Ù„Ø£Ù†Ø¯Ù„Ø³)</button>
      </div>
    </div>
  </div>

  <div id="view-seasons" class="section-view">
    <div class="card">
      <h1>Ø§Ù„Ù…ÙˆØ§Ø³Ù… ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h1>
      <div class="subtitle">ÙŠØªÙ… ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ù‚Ø§Ø¯Ù… (Ø®Ù„Ø§Ù„ 60 ÙŠÙˆÙ…Ø§Ù‹) Ø¨Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ</div>
      <table class="seasons-table">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
            <th>Ø§Ù„Ø­Ø¯Ø«</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</th>
          </tr>
        </thead>
        <tbody id="seasonsBody"></tbody>
      </table>
    </div>
  </div>

</div>

<div class="sign-off">
  <span>ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø© <b>Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡</b></span>
  <span class="sign-off-email"> | 77aayy@gmail.com</span>
</div>

<script>
/* =========================================================
   GLOBAL & TABS
   ========================================================= */
function switchTab(tabId) {
  document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.switchBtn').forEach(el => el.classList.remove('active'));
  
  document.getElementById('view-' + tabId).classList.add('active');
  const btns = document.querySelectorAll('.switchBtn');
  if(tabId==='compare') btns[0].classList.add('active');
  if(tabId==='booking') btns[1].classList.add('active');
  if(tabId==='seasons') btns[2].classList.add('active');
}

/* =========================================================
   COMPARE LOGIC (UNCHANGED)
   ========================================================= */
const CANONICAL_TYPES = ["Ø´Ù‚Ø© Ø¨ØºØ±ÙØªÙŠ Ù†ÙˆÙ…", "Ø´Ù‚Ø© Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±", "Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù…Ø§Ù…ÙŠ", "ØºØ±ÙØ© ÙƒÙŠÙ†Ø¬ Ù…ÙØ±Ø¯", "ØºØ±ÙØ© ØªØ¤Ù… Ø®Ù„ÙÙŠØ©", "VIP"];
const CANCEL_FLAGS = ["cancel", "cancelled", "cancelled_by_guest", "Ù…Ù„ØºÙŠ", "ÙƒÙ†Ø³Ù„"];
window.nazeelLastRunData = null;
window.bookingLastRunData = null;

function mapUnit(raw) {
  if (!raw) return null;
  const s = raw.toString().trim();
  if (s.includes("ØºØ±ÙØªÙŠÙ†") || s.includes("ØºØ±ÙØªÙŠ")) return "Ø´Ù‚Ø© Ø¨ØºØ±ÙØªÙŠ Ù†ÙˆÙ…";
  if (s.includes("ØµØ§Ù„Ø© Ù…Ø·Ù„Ù‡") || s.includes("ØµØ§Ù„Ø© Ù…Ø·Ù„Ø©") || s.includes("Ù†ÙˆÙ… Ù…Ø·Ù„Ø©") || s.includes("Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø©") || s.includes("Sea View")) return "Ø´Ù‚Ø© Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±";
  if (s.includes("Ø³ØªÙˆØ¯ÙŠÙˆ") && s.includes("Ø§Ù…Ø§Ù…ÙŠ")) return "Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù…Ø§Ù…ÙŠ";
  if (s.toUpperCase().includes("VIP")) return "VIP";
  if ((s.includes("ÙƒÙŠÙ†Ø¬") || s.includes("King")) && !s.includes("ØªØ¤Ù…") && !s.includes("Twin")) return "ØºØ±ÙØ© ÙƒÙŠÙ†Ø¬ Ù…ÙØ±Ø¯";
  if (s.includes("ØªØ¤Ù…") || s.includes("Twin")) return "ØºØ±ÙØ© ØªØ¤Ù… Ø®Ù„ÙÙŠØ©";
  return null;
}

function getSmartRecommendation(diff) {
    if (diff === 1) return 'âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 1. ÙˆÙ„Ùˆ Ø£Ø¬Ù‘Ø±Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù‚ÙÙ„Ù‡Ø§ Ø¨ÙˆÙƒÙŠÙ†Ø¬';
    else if (diff === 2) return 'âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 1 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
    else if (diff === 3) return 'âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 2 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
    else if (diff === 4) return 'âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ 4. Ø§Ù„Ø´Ø§ØºØ± ÙƒØªÙŠØ±';
    else if (diff > 4) return `âœ… Ø§Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ ØªÙØªØ­ ${diff - 1} Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„. Ø£Ù†Øª ÙÙŠ Ø§Ù„Ø£Ù…Ø§Ù†`;
    return 'âœ… Ø§ÙØªØ­ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØºØ±Ù';
}

function processBooking(rows) {
  const stats = {};
  const ARIVED_TERMS = ["ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯", "paid", "Ø¹Ø±Ø¨ÙˆÙ†", "deposit", "Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"]; 
  CANONICAL_TYPES.forEach(t => stats[t] = { expected:0, expList:[], arrived:0, arrList:[], arrDep:0, noShow:0, nsList:[] });
  let idxStatus=-1, idxUnit=-1, idxPayStatus=-1, idxPayRaw=-1, idxGuest=-1, headerRow=-1;
  for(let r=0; r<Math.min(rows.length, 25); r++) {
    const row = rows[r];
    for(let c=0; c<row.length; c++) {
      const val = (row[c]||"").toString().toLowerCase().trim();
      if(val === "status" || val === "Ø§Ù„Ø­Ø§Ù„Ø©" || val.includes("booking status")) idxStatus = c;
      if(val.includes("unit") || val.includes("room") || val.includes("Ø§Ù„ÙˆØ­Ø¯Ø©") || val.includes("accommodation")) idxUnit = c;
      if(val.includes("guest") || val.includes("Ø§Ù„Ø¶ÙŠÙ")) idxGuest = c;
      if(val === "payment status" || val === "Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹") idxPayStatus = c;
      else if((val.includes("payment") || val.includes("Ø§Ù„Ø¯ÙØ¹")) && idxPayStatus === -1) idxPayRaw = c;
    }
    if(idxStatus !== -1 && idxUnit !== -1) { headerRow = r; break; }
  }
  if(headerRow === -1) throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Booking.");
  const activePayIdx = idxPayStatus !== -1 ? idxPayStatus : idxPayRaw;
  let foundCount = 0;
  for(let r=headerRow+1; r<rows.length; r++) {
    const row = rows[r];
    const status = (row[idxStatus]||"").toString().toLowerCase().trim();
    const unitStr = (row[idxUnit]||"").toString();
    const payVal = activePayIdx !== -1 ? (row[activePayIdx]||"").toString().trim() : "";
    const guestName = idxGuest !== -1 ? (row[idxGuest]||"").toString() : "Guest";
    if(status !== "ok") continue;
    if(CANCEL_FLAGS.some(f => JSON.stringify(row).toLowerCase().includes(f))) continue;
    foundCount++;
    const units = [];
    unitStr.split(",").forEach(p => {
       const m = p.trim().match(/^(\d+)\s*x\s*(.+)$/i);
       if(m) { for(let i=0; i<+m[1]; i++) units.push(m[2]); } else units.push(p);
    });
    const isExplicitlyPaid = ARIVED_TERMS.some(term => payVal.toLowerCase().includes(term));
    const isNoShow = payVal === "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯" || payVal.toLowerCase() === "not paid";
    const isEmpty = payVal === "";
    units.forEach(u => {
      const type = mapUnit(u); if(!type) return;
      const debugInfo = `<div style="font-size:11px; color:#888">${guestName} [${payVal || "Empty"}]</div>`;
      if (isNoShow) { stats[type].noShow++; stats[type].nsList.push(debugInfo); }
      else if (isExplicitlyPaid || (!isEmpty && !isNoShow)) { 
        stats[type].arrived++;
        if(payVal.includes("Ø¹Ø±Ø¨ÙˆÙ†") || payVal.toLowerCase().includes("deposit")) { stats[type].arrDep++; stats[type].arrList.push(debugInfo.replace("]", " - Ø¹Ø±Ø¨ÙˆÙ†]")); }
        else { stats[type].arrList.push(debugInfo); }
      } else if (isEmpty) { stats[type].expected++; stats[type].expList.push(debugInfo); }
    });
  }
  if(foundCount === 0) throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª OK.");
  return stats;
}

function processNazeel(rows) {
  const todayStr = new Date().toISOString().split("T")[0];
  let colStatus=-1, colRoom=-1, colOut=-1, headerRow=-1;
  for(let r=0; r<Math.min(rows.length,25); r++) {
    const row = rows[r];
    for(let c=0; c<row.length; c++) {
      const v = (row[c]||"").toString().trim();
      if (v==="Ø§Ù„Ø­Ø§Ù„Ø©" || v==="Status") colStatus=c;
      if (v.includes("Ø§Ù„ØºØ±ÙØ©") || v.includes("Room")) colRoom=c;
      if (v.includes("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬") || v.includes("Departure")) colOut=c;
    }
    if(colStatus!==-1 && colRoom!==-1) { headerRow=r; break; }
  }
  const stats = {}; CANONICAL_TYPES.forEach(t => stats[t] = { vac:0, vacList:[], dep:0, depList:[] }); 
  if(headerRow===-1) throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Nazeel.");
  for(let r=headerRow+1; r<rows.length; r++) {
    const row = rows[r];
    const status = (row[colStatus]||"").toString().trim();
    const room = (row[colRoom]||"").toString().trim();
    const outDate = row[colOut];
    if(!room || room.includes("104") || (room.includes("Ø°ÙˆÙŠ") && room.includes("Ø¹Ø§Ù‚Ø©"))) continue;
    const type = mapUnit(room); if(!type) continue;
    if(["ÙØ§Ø±ØºØ©", "ØªÙ†Ø¸ÙŠÙ", "Vacant", "Dirty"].includes(status)) {
      stats[type].vac++; stats[type].vacList.push(`<span style="font-size:11px; display:inline-block; margin:1px; padding:2px 5px; background:#eee; border-radius:4px;">${room}</span>`);
    }
    let isToday = false;
    if(status.includes("Ù…ØºØ§Ø¯Ø±Ø©") || status.includes("Departure")) isToday = true; 
    else if(outDate && (outDate.toString().includes(todayStr) || outDate.toString().includes(new Date().toLocaleDateString('en-GB')))) isToday = true;
    if((status==="Ù…Ø¤Ø¬Ø±Ø©" || status==="Occupied") && isToday) {
      stats[type].dep++; stats[type].depList.push(`<span style="font-size:11px; display:inline-block; margin:1px; padding:2px 5px; background:#eef; border-radius:4px;">${room}</span>`);
    }
  }
  return stats;
}

function runAudit() {
  const errDiv = document.getElementById("errorArea"); errDiv.style.display = "none";
  const fB = document.getElementById("fileBooking").files[0];
  const fN = document.getElementById("fileNazeel").files[0];
  if(!fB || !fN) { errDiv.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹"; errDiv.style.display = "block"; return; }
  const rB = new FileReader();
  rB.onload = e => {
    try {
      const wb = XLSX.read(e.target.result, {type:'array'});
      const statsB = processBooking(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1}));
      const rN = new FileReader();
      rN.onload = e2 => {
        try {
          const wb2 = XLSX.read(e2.target.result, {type:'array'});
          const statsN = processNazeel(XLSX.utils.sheet_to_json(wb2.Sheets[wb2.SheetNames[0]], {header:1}));
          window.nazeelLastRunData = statsN; window.bookingLastRunData = statsB;
          draw(statsB, statsN);
        } catch(x) { errDiv.textContent = "Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù Ù†Ø²ÙŠÙ„: " + x.message; errDiv.style.display = "block"; }
      };
      rN.readAsArrayBuffer(fN);
    } catch(x) { errDiv.innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù Ø¨ÙˆÙƒÙŠÙ†Ø¬:<br>" + x.message; errDiv.style.display = "block"; }
  };
  rB.readAsArrayBuffer(fB);
}

function draw(b, n) {
  document.getElementById("output").style.display = 'block';
  let h1 = `<table><thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th><th>ÙˆØµÙ„</th><th>No Show</th></tr></thead><tbody>`;
  CANONICAL_TYPES.forEach(t => {
    const d = b[t]; if (!d) return; 
    h1 += `<tr><td>${t}</td><td>${d.expected>0?`<span class="badge badge-ok">${d.expected} (OK)</span>`:"0"} ${d.expList?d.expList.join(""):""}</td><td>${d.arrived>0?`<b>${d.arrived}</b>`+(d.arrDep>0?` <span class="badge badge-gold">(${d.arrDep} Ø¹Ø±Ø¨ÙˆÙ†)</span>`: ""):"0"} ${d.arrList?d.arrList.join(""):""}</td><td>${d.noShow>0?`<span class="badge badge-err">${d.noShow}</span>`:"0"} ${d.nsList?d.nsList.join(""):""}</td></tr>`;
  });
  document.getElementById("tableBooking").innerHTML = h1 + "</tbody></table>";

  let h2 = `<table><thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø´Ø§ØºØ±</th><th>Ø®Ø±ÙˆØ¬ Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ù…ØªØ§Ø­</th></tr></thead><tbody>`;
  CANONICAL_TYPES.forEach(t => {
    const d = n[t]; if (!d) return;
    const avail = (d.vac||0) + Math.round((d.dep||0)*0.40);
    h2 += `<tr><td>${t}</td><td><b>${d.vac||0}</b> ${d.vacList?d.vacList.join(""):""}</td><td>${d.dep||0} ${d.depList?d.depList.join(""):""}</td><td><span class="badge badge-warn" style="font-size:1rem">${avail}</span></td></tr>`;
  });
  document.getElementById("tableNazeel").innerHTML = h2 + "</tbody></table>";

  let h3 = `<table><thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ù…ØªØ§Ø­</th><th>Ù…Ø·Ù„ÙˆØ¨</th><th>Ø§Ù„ÙØ±Ù‚</th><th>Ø§Ù„ØªÙˆØµÙŠØ©</th></tr></thead><tbody>`;
  CANONICAL_TYPES.forEach(t => {
    const nData = n[t], bData = b[t]; if (!nData && !bData) return;
    const avail = nData ? ((nData.vac||0) + Math.round((nData.dep||0)*0.40)) : 0;
    const req = bData ? bData.expected : 0;
    if (avail === 0 && req === 0) return;
    const diff = avail - req;
    let rec = diff > 0 ? getSmartRecommendation(diff) : (diff < 0 ? 'â›” Ø£ØºÙ„Ù‚ ÙÙˆØ±Ø§Ù‹' : 'â¸ï¸ Ù…ØªÙˆØ§Ø²Ù†');
    let cls = diff > 0 ? 'badge-ok' : (diff < 0 ? 'badge-err' : 'badge-gold');
    h3 += `<tr><td>${t}</td><td>${avail}</td><td>${req}</td><td><span class="badge ${cls}">${diff}</span></td><td style="font-weight:bold">${rec}</td></tr>`;
  });
  document.getElementById("tableCompare").innerHTML = h3 + "</tbody></table>";
}

function exportComparisonToExcel() {
    const wb = XLSX.utils.book_new();
    const wsData = [["Ø§Ù„Ù†ÙˆØ¹", "Ù…ØªØ§Ø­", "Ù…Ø·Ù„ÙˆØ¨", "Ø§Ù„ÙØ±Ù‚", "Ø§Ù„ØªÙˆØµÙŠØ©"]];
    CANONICAL_TYPES.forEach(t => {
        const nData = window.nazeelLastRunData[t], bData = window.bookingLastRunData[t];
        const avail = nData ? ((nData.vac||0) + Math.round((nData.dep||0)*0.40)) : 0;
        const req = bData ? bData.expected : 0;
        if (avail === 0 && req === 0) return;
        wsData.push([t, avail, req, avail-req, avail-req > 0 ? getSmartRecommendation(avail-req) : 'Check']);
    });
    wsData.push([], ["ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨ÙˆØ§Ø³Ø·Ø©: Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ ÙˆØ±Ø¯Ù‡"]);
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(wsData), "Report");
    XLSX.writeFile(wb, "Audit_Report.xlsx");
}

/* =========================================================
   CALCULATOR LOGIC (Auto-Clear & Restored)
   ========================================================= */
// (1) Auto-Clear Logic
function enhanceInputs() {
    document.querySelectorAll("input[type='number']").forEach(inp => {
        if(!inp.readOnly){
            inp.addEventListener("focus", function() {
                this.dataset.oldValue = this.value;
                this.value = "";
            });
            inp.addEventListener("blur", function() {
                if(this.value.trim() === "") this.value = this.dataset.oldValue || "0";
            });
        }
    });
}

function calc(branch,i){
    let p=parseFloat(document.getElementById(branch+'_p'+i).value)||0;
    let r=parseFloat(document.getElementById(branch+'_r'+i).value)||0;
    document.getElementById(branch+'_b'+i).value=(p*(1+r/100)).toFixed(2);
}
function setUnify(branch){
    let unify=document.getElementById(branch==='c'?'unifyC':'unifyA').checked;
    let rate=parseFloat(document.getElementById(branch==='c'?'rateC':'rateA').value)||0;
    let rows=branch==='c'?5:9;
    for(let i=1;i<=rows;i++){
        document.getElementById(branch+'_r'+i).value = unify?rate:45;
        calc(branch,i);
    }
}
function downloadExcel(branch){
    const wb=XLSX.utils.book_new();
    const rows = branch==='c'?5:9;
    let data=[["Ø§Ù„ÙˆØ­Ø¯Ø©","Ø§Ù„Ø³Ø¹Ø±","Ø¨ÙˆÙƒÙŠÙ†Ø¬"]];
    for(let i=1;i<=rows;i++){
        data.push([
            document.querySelector(`#${branch==='c'?'corniche':'andalus'} table tr:nth-child(${i+1}) td:first-child`).innerText,
            document.getElementById(branch+'_p'+i).value,
            document.getElementById(branch+'_b'+i).value
        ]);
    }
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(data), "Sheet");
    XLSX.writeFile(wb, branch==='c'?'Corniche.xlsx':'Andalus.xlsx');
}

/* =========================================================
   SEASONS LOGIC (Smart Highlight)
   ========================================================= */
const seasonEvents = [
  { greg: "26/06/2025", hijri: "01/01/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨ 1447", type: "Ù…ÙˆØ³Ù…" },
  { greg: "24/08/2025", hijri: "01/03/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026 (1447-1448)", type: "Ø±ÙƒÙˆØ¯" },
  { greg: "23/09/2025", hijri: "01/04/1447", title: "Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ 2025", type: "Ù…ÙˆØ³Ù…" },
  { greg: "21/11/2025", hijri: "30/05/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ 2025", type: "Ù…ÙˆØ³Ù…" },
  { greg: "29/11/2025", hijri: "08/06/1447", title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ 2025", type: "Ù…ÙˆØ³Ù…" },
  { greg: "11/12/2025", hijri: "20/06/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ© 2025", type: "Ù…ÙˆØ³Ù…" },
  { greg: "14/12/2025", hijri: "23/06/1447", title: "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© 2025", type: "Ù…ÙˆØ³Ù…" },
  { greg: "09/01/2026", hijri: "20/07/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "17/01/2026", hijri: "28/07/1447", title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "22/02/2026", hijri: "05/09/1447", title: "Ø¥Ø¬Ø§Ø²Ø© ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³ 2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "06/03/2026", hijri: "17/09/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± 2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "28/03/2026", hijri: "09/10/1447", title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± 2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "22/05/2026", hijri: "15/12/1447", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ 2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "01/06/2026", hijri: "25/12/1447", title: "Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ 2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "25/06/2026", hijri: "10/01/1448", title: "Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø¬Ø§Ø²Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026", type: "Ù…ÙˆØ³Ù…" },
  { greg: "11/08/2026", hijri: "28/02/1448", title: "Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ† 2026", type: "Ø±ÙƒÙˆØ¯" },
  { greg: "16/08/2026", hijri: "03/03/1448", title: "Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† 2026", type: "Ø±ÙƒÙˆØ¯" },
  { greg: "23/08/2026", hijri: "10/03/1448", title: "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2026-2027 (1448-1449)", type: "Ø±ÙƒÙˆØ¯" }
];

function parseDMY(str) {
  const parts = str.split("/");
  return new Date(parseInt(parts[2],10), parseInt(parts[1],10)-1, parseInt(parts[0],10));
}

function buildSeasonsTable() {
  const today = new Date();
  today.setHours(0,0,0,0);
  const sorted = seasonEvents.slice().sort((a,b) => parseDMY(a.greg) - parseDMY(b.greg));
  const tbody = document.getElementById('seasonsBody');
  if (!tbody) return;
  tbody.innerHTML = "";
  
  let foundNext = false; // Ù„ØªÙ…ÙŠÙŠØ² Ø£ÙˆÙ„ Ù…ÙˆØ³Ù… Ù‚Ø§Ø¯Ù… ÙÙ‚Ø·

  for (const ev of sorted) {
    const evDate = parseDMY(ev.greg);
    const diffTime = evDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    // Ø§Ù„Ø´Ø±ÙˆØ·: ØªØ§Ø±ÙŠØ® Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ + Ø®Ù„Ø§Ù„ 60 ÙŠÙˆÙ… + Ù„Ù… Ù†Ø¬Ø¯ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ù‚Ø¨Ù„Ù‡
    const isNext = !foundNext && diffDays >= 0 && diffDays <= 60;
    
    const tr = document.createElement('tr');
    if (isNext) {
        tr.className = 'highlight-next-season';
        foundNext = true; // Ù„Ø¶Ù…Ø§Ù† ØªÙ…ÙŠÙŠØ² ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
    }

    const tdType = document.createElement('td');
    const badge = document.createElement('span');
    badge.className = 'badge ' + (ev.type === 'Ù…ÙˆØ³Ù…' ? 'badge-season' : 'badge-rukood');
    badge.textContent = ev.type === 'Ù…ÙˆØ³Ù…' ? 'Ù…ÙˆØ³Ù…' : 'Ø¯Ø±Ø§Ø³Ø©';
    tdType.appendChild(badge);

    const tdTitle = document.createElement('td'); tdTitle.textContent = ev.title + (isNext ? " (Ù‚Ø±ÙŠØ¨Ø§Ù‹ ğŸ”¥)" : "");
    const tdHijri = document.createElement('td'); tdHijri.textContent = ev.hijri;
    const tdGreg = document.createElement('td'); tdGreg.textContent = ev.greg;

    tr.appendChild(tdType); tr.appendChild(tdTitle); tr.appendChild(tdHijri); tr.appendChild(tdGreg);
    tbody.appendChild(tr);
  }
}

// Initialize
window.onload = function(){
    for(let i=1;i<=5;i++) calc('c',i);
    for(let i=1;i<=9;i++) calc('a',i);
    enhanceInputs(); // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    buildSeasonsTable(); // ØªÙØ¹ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø°ÙƒÙŠ
};
</script>

</body>
</html>
